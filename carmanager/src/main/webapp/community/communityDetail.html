<!DOCTYPE HTML>
<!-- 현재 스크립트나 CSS 임포트는 각 기능이 있는 위치에 쓰여있기 때문에 
     실제로 사용할 때 정리해서 사용할 것을 권장합니다. -->
<html>
<head>
<title>new 내 차를 부탁해</title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />
  <link type='text/css' rel="stylesheet" href="../css/community/communityDetail.css">
  <link type='text/css' rel="stylesheet" href="../css/community/cstyle.css">
  <link type='text/css' rel="stylesheet" href="../css/community/default.css">
  <link type='text/css' rel='stylesheet' href="../lib/bootstrap/css/bootstrap.css" />
  <link type='text/css' rel="stylesheet" href="../lib/sweetalert/sweetalert.css">
  <link type="text/css" rel="stylesheet" media="all" href="../css/main/animate.css" >
  <link type="text/css" rel="stylesheet" href="../css/main/custom.css">
  <link type='text/css' rel='stylesheet' href="../css/main/style.css" />
  <link type='text/css' rel='stylesheet' 
        href='http://fonts.googleapis.com/css?family=PT+Sans:400,700'>
  <link type='text/css' rel='stylesheet'
        href='http://fonts.googleapis.com/css?family=Roboto+Condensed:400,300,300italic,400italic,700,700italic'>
  <link type='text/css' rel='stylesheet' 
        href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow&v1' />
  <link type='text/css' rel='stylesheet' 
        href='http://fonts.googleapis.com/css?family=Oswald' />
  <link type='text/css' rel='stylesheet' 
        href='http://fonts.googleapis.com/css?family=Ovo' />

	<script src="../lib/jquery/jquery.min.js"></script>
	<script src="../js/community/sugar.min.js"></script>
	<script src="../lib/sweetalert/sweetalert.min.js"></script>
  <script src="../lib/bootstrap/js/bootstrap.min.js"></script>
  <script src="../js/main/classie.js"></script>
  <script src="../js/main/custom.js"></script>
  <script src="../js/main/metisMenu.min.js"></script>
	<script src="../js/main/modernizr.custom.js"></script>
  <script src="../js/main/moment_local.js"></script>
	<script src="../js/main/wow.min.js"></script>

	<script>
  new WOW().init();
  $(document).ready(function(){ 
	  sessionStorage.removeItem('searchCategory');
    var userNickname = sessionStorage.getItem('loginUserNickname');
    var userCarNo = sessionStorage.getItem('loginUsercarNo');
    var userPhoto = sessionStorage.getItem('loginUserPhoto');
     $("#userNickname").html(userNickname + "님");
     $("#thumbnail").attr("src", "../img/member/m-" + userPhoto + ".png");
     $("#comment_writer").text(userNickname);
  });  
	
	</script>
	
	<script type="application/x-javascript">
    addEventListener("load", function() { 
    setTimeout(hideURLbar, 0); }, false); 
    function hideURLbar(){ 
    window.scrollTo(0,1); } 
  </script>
	
</head>

<body class="cbp-spmenu-push">
  <div class="main-content">
    <div class=" sidebar" role="navigation">
      <div class="navbar-collapse">
        <nav class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left"
          id="cbp-spmenu-s1">
          <ul class="nav" id="side-menu">
            <li><a href="../main/main.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/dash.png">Dashboard</a></li>
            <li><a href="../mypage/mypage.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/mypage.png">My page</a></li>
            <li><a href="../garage/garage.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/garage.png">차량 등록</a></li>
            <li><a href="../refuel/refuelManager.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/refuel.png">차량 관리</a></li>
            <li><a href="../center/center.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/center.png">정 비 소</a></li>
            <li><a href="../goods/goods.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/goods.png">맞춤 서비스</a></li>
            <li><a href="../community/community.html" id="menu_active" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/community.png">커뮤니티</a></li>
          </ul>
        </nav>
      </div>
    </div>

    <div class="sticky-header header-section ">
      <div class="header-left">
        <!--toggle button start-->
        <button id="showLeftPush">
          <img class="img_menubtn" src="../img/main/menu.png">
        </button>
        <!--toggle button end-->
        <!--logo -->
        <div class="logo">
          <a href="../main/main.html">
            <h1>내 차를 부탁해</h1>
            <span>간편, 쉽고, 재밌는 시작!</span>
          </a>
        </div>
      </div>

      <div class="header-right">
        <!-- 로그인 유저 정보 -->
        <div class="profile_details">
          <ul>
	          <li class="dropdown profile_details_drop">
	            <a href="#" class="dropdown-toggle" 
	               data-toggle="dropdown" aria-expanded="false">
	              <div class="profile_img">
	                <span class="prfil-img">
	                  <img id="thumbnail" class="img-rounded" src="" alt=""> 
	                </span>
	                <div class="user-name">
	                  <p id="userNickname"></p>
	                  <span>안녕하세요.</span>
	                </div>
	                <!-- 빈칸 유지를 위한 아이콘 자리 -->
	                <i class="fa fa-angle-down lnr"></i> 
	                <i class="fa fa-angle-up lnr"></i>
	                <div class="clearfix"></div>
	              </div>
	            </a>
	            <ul class="dropdown-menu drp-mnu">
	              <li><a id="Mypage" href="#"><i class="fa fa-cog"></i>Mypage</a></li>
	              <li><a id="Logout" href="#"><i class="fa fa-sign-out"></i>Logout</a></li>
	            </ul>
	          </li>
          </ul>
        </div>
        <div class="clearfix"></div>
      </div>
      <div class="clearfix"></div>
    </div>
    <!-- //header-ends -->
    <script>
    $('#Mypage').click(function(event){
        location.href = "../mypage/mypage.html";
    });
    
    $('#Logout').click(function(event){
        event.preventDefault();
        sessionStorage.removeItem('loginUserNickname');
        sessionStorage.removeItem('loginUsercarNo');
        sessionStorage.removeItem('loginUserPhoto');
        location.href = "../auth/login.html";
      });
    </script>

    <div id="page-wrapper">
      <div class="main-page compose">
	      <div>
	        <h3 class="title">커뮤니티에 들어오셨습니다&nbsp;:</h3>
	        <h4>근거 없는 비방, 홍보, 관련되지 않은 게시물은 관리자에 의해 삭제 될 수 있습니다.</h4>
	        <p>&nbsp;</p>
	      </div>
	      <div class="col-md-8 compose-right widget-shadow">
	        <div class="panel-default">
	          <div class="panel-heading">
	            <span id="bcategory"></span>
	            <h3 id="btitle"></h3>
	          </div>
              <div id="nickncredt">
		            <span id="bnickname"></span>
		            <span id="bcreatedDate"></span>
	            </div>
	          <div class="panel-body">
	            <div class="container" id="container">
	              <div id="bcontent"></div>
	            </div>
	            <div id="bodyfooter">
		            <span id="viewnlike">
		              <label>조회 : </label>
		              <span id="bviews"></span>
		              <a id="likeLink" href="#">추천 : </a>
		              <span id="blikes"></span>
		            </span>
	            </div>
	              
	            </div>
	            <div id="list_footer" class="panel-heading">
		            <button id='addBtn' type='button' 
	                      class="btn btn-default">글쓰기</button>
	              <button id='updateBtn' type='button' 
	                      class="btn btn-default" style="">수정</button>
	              <button id='deleteBtn' type='button' 
	                      class="btn btn-default" style="">삭제</button>&nbsp;
	              <button id='listBtn' type='button' 
	                      class="btn btn-default">목록</button>
	            </div>
	          </div>
	        </div>
		      
		      <div class="col-md-8 compose-right widget-shadow commentWrap">
		        <div class="panel-default">
		          <div id="commentBody" class="panel-body">
		            <div>
		              <span id="comment_writer"></span>
		              <span>
	                  <button id="commentBtn" class="btn btn-default btn-xs" type="button">등록</button>
	                </span>
	 		            <div id="comment_text_div">
			              <textarea id="comment_text" rows="4" cols="100" placeholder="내용을 입력해주세요"></textarea>
			            </div>
		            </div>
		          </div>
		        </div>
		      </div>
		      <div class="clearfix"> </div>
        </div>
      </div>
      
    <div class="footer">
      <p>
        &copy; 2016 Java76th 태웅 재한 영호 다인. All Rights Reserved | Project by <a href="" target="_blank">내 차를 부탁해</a>
      </p>
    </div>
  </div>
  
  <script>
  var menuLeft = document.getElementById('cbp-spmenu-s1'), 
      showLeftPush = document.getElementById('showLeftPush'), 
      body = document.body;

  showLeftPush.onclick = function() {
    classie.toggle(this, 'active');
    classie.toggle(body, 'cbp-spmenu-push-toright');
    classie.toggle(menuLeft, 'cbp-spmenu-open');
    disableOther('showLeftPush');
  };

  function disableOther(button) {
    if (button !== 'showLeftPush') {
      classie.toggle(showLeftPush, 'disabled');
    }
  }
  
  var no = location.href.split('?')[1].split('=')[1];
  var writer;
  
  $.getJSON('../community/ajax/detail.do?no=' + no, function(resultObj) {
    var ajaxResult = resultObj.ajaxResult;
    if (ajaxResult.status == "success") {
      var board = ajaxResult.data;
      var credate = Date.create(board.createdDate);
      $("#btitle").text(board.title);
      $("#bcategory").html("[" + board.category + "]&nbsp;&nbsp;");
      $("#bnickname").html("작성자 | " + board.nickname + "&nbsp;&nbsp;");
      $("#bcontent").html(board.content);
      $("#bviews").html(board.views + "&nbsp;&nbsp;");
      $("#blikes").text(board.likes);
      $("#bcreatedDate").text("작성일 | " + credate.format('{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}'));
      
      if (sessionStorage.getItem('loginUserNickname') != board.nickname) {
    	  $('#updateBtn').attr('style', 'display:none;');
    	  $('#deleteBtn').attr('style', 'display:none;');
      }
    }
  });
  
  $.getJSON('../comment/ajax/list.do?no=' + no, function(resultObj) {
	  var commentBody = $('#commentBody');
	  for (var comment of resultObj.data) {
		  var credate = Date.create(comment.createdDate);
	    $("<span>").html(
	        "<span style='font-weight:bold;'>" + comment.nickname + "</span>" +
	        "&nbsp;<span>("+ credate.format('{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}') +")</span>"
	     ).appendTo(commentBody);
	    if (sessionStorage.getItem('loginUserNickname') == comment.nickname) {
	    	$("<span>").html(
	    			"<a href='#' class='deleteLink' commentNo='" + comment.commentNo + "'>" +
	    			  "&nbsp;<img id='deleteImg' src='../img/community/delete.png'>" +
	    			"</a>"
    			).appendTo(commentBody);
	    }
	    $("<div>").html(
	      "<div id='comment_content' class='panel-footer' style='border:1px solid lightgray'>" + comment.content + "</div><br>"
	    ).appendTo(commentBody);
	  }
	  $(".deleteLink").click(clickDelete);
  });
  
  $('#listBtn').click(function(event) {
	  location.href = "community.html";
  });
  
  $('#addBtn').click(function(event){
	    location.href = "communityForm.html";
  });
  
  $('#updateBtn').click(function(event){
      location.href = "communityForm.html?no=" + no;
  });
  
  $('#deleteBtn').click(function(event){
	  $.getJSON('../community/ajax/delete.do?no=' + no, function(resultObj) {
		  var ajaxResult = resultObj.ajaxResult;
		    if (ajaxResult.status == "success") {
		    	swal({    
            title: "글을 삭제했습니다!",   
            type: "success",
            confirmButtonText: "확인"
          }, function() {location.href = "community.html";});
		    }
	  });
  });
  
  $('#likeLink').click(function(event) {
	    $.getJSON('../community/ajax/likesUp.do?no=' + no, function(resultObj) {
	    	var ajaxResult = resultObj.ajaxResult;
	        if (ajaxResult.status == "success") {
	        	swal({    
              title: "글을 추천했습니다!",   
              type: "success",
              confirmButtonText: "확인"
            }, function() {location.href = "communityDetail.html?no=" + no;});
	        }
	    });  	
  });
  
  $('#commentBtn').click(function(event){
	  $.post('../comment/ajax/add.do', {
      boardNo: no,
		  memberNo: sessionStorage.getItem("loginUser"),
      content: $('#comment_text').val()
    }, function(resultObj) {
      var ajaxResult = resultObj.ajaxResult;
      if (ajaxResult.status == "failure") { 
        swal({   
          title: "Error!",   
          text: "댓글 등록 실패!",   
          type: "error",   
          confirmButtonText: "확인 ;(" });
        return false;
      }

      location.href = "communityDetail.html?no=" + no;
    }, 'json');  
  });
	  
  function clickDelete(event) {
	  $.getJSON('../comment/ajax/delete.do?no=' + $(this).attr("commentNo"), function(resultObj) {
		  location.href = "communityDetail.html?no=" + no;
	  });
  }
  </script>
  <script src="../js/main/jquery.nicescroll.js"></script>
  <script src="../js/main/scripts.js"></script>
</body>
</html>
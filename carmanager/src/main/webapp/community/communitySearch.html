<!DOCTYPE HTML>
<!-- 현재 스크립트나 CSS 임포트는 각 기능이 있는 위치에 쓰여있기 때문에 
     실제로 사용할 때 정리해서 사용할 것을 권장합니다. -->
<html>
<head>
<title>new 내 차를 부탁해</title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link type='text/css' rel="stylesheet" href="../css/community/community.css">
  <link type='text/css' rel="stylesheet" href="../css/community/cstyle.css">
  <link type='text/css' rel="stylesheet" href="../css/community/default.css">
  <link type='text/css' rel='stylesheet' href="../lib/bootstrap/css/bootstrap.css" />
  <link type='text/css' rel="stylesheet" href="../lib/sweetalert/sweetalert.css">
  <link type="text/css" rel="stylesheet" media="all" href="../css/main/animate.css" >
  <link type="text/css" rel="stylesheet" href="../css/main/custom.css">
  <link type='text/css' rel='stylesheet' href="../css/main/style.css" />
  <link type='text/css' rel='stylesheet' 
        href='http://fonts.googleapis.com/css?family=PT+Sans:400,700'>
  <link type='text/css' rel='stylesheet'
        href='http://fonts.googleapis.com/css?family=Roboto+Condensed:400,300,300italic,400italic,700,700italic'>
  <link type='text/css' rel='stylesheet' 
        href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow&v1' />
  <link type='text/css' rel='stylesheet' 
        href='http://fonts.googleapis.com/css?family=Oswald' />
  <link type='text/css' rel='stylesheet' 
        href='http://fonts.googleapis.com/css?family=Ovo' />


	<script src="../lib/jquery/jquery.min.js"></script>
	<script src="../lib/sweetalert/sweetalert.min.js"></script>
	<script src="../js/community/jquery.selecty.js"></script>
	<script src="../js/community/jquery.pagenavigator.js"></script>
  <script src="../lib/bootstrap/js/bootstrap.min.js"></script>
  <script src="../js/main/classie.js"></script>
  <script src="../js/main/custom.js"></script>
  <script src="../js/main/metisMenu.min.js"></script>
	<script src="../js/main/modernizr.custom.js"></script>
  <script src="../js/main/moment_local.js"></script>
	<script src="../js/main/wow.min.js"></script>

	<script>
  new WOW().init();
  $(document).ready(function(){ 
    var userNickname = sessionStorage.getItem('loginUserNickname')+ "님";
    var userCarNo = sessionStorage.getItem('loginUsercarNo');
    var userPhoto = sessionStorage.getItem('loginUserPhoto');
    if (sessionStorage.getItem('searchCategory') != null) {
   	  document.getElementById('category').value = sessionStorage.getItem('searchCategory');
    }
    $("#userNickname").html(userNickname);
    $("#thumbnail").attr("src", "../img/member/m-" + userPhoto + ".png");
  });  
	
	</script>
	
	<script type="application/x-javascript">
    addEventListener("load", function() { 
    setTimeout(hideURLbar, 0); }, false); 
    function hideURLbar(){ 
    window.scrollTo(0,1); } 
  </script>
	
</head>

<body class="cbp-spmenu-push">
  <div class="main-content">
    <div class=" sidebar" role="navigation">
      <div class="navbar-collapse">
        <nav class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left"
          id="cbp-spmenu-s1">
          <ul class="nav" id="side-menu">
            <li><a href="../main/main.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/dash.png">Dashboard</a></li>
            <li><a href="../mypage/mypage.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/mypage.png">My page</a></li>
            <li><a href="../garage/garage.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/garage.png">차량 등록</a></li>
            <li><a href="../refuel/refuel.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/refuel.png">차량 관리</a></li>
            <li><a href="../center/center.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/center.png">정 비 소</a></li>
            <li><a href="../goods/goods.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/goods.png">맞춤 서비스</a></li>
            <li><a href="../community/community.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/community.png">커뮤니티</a></li>
          </ul>
        </nav>
      </div>
    </div>

    <div class="sticky-header header-section ">
      <div class="header-left">
        <!--toggle button start-->
        <button id="showLeftPush">
          <img class="img_menubtn" src="../img/main/menu.png">
        </button>
        <!--toggle button end-->
        <!--logo -->
        <div class="logo">
          <a href="../main/main.html">
            <h1>내 차를 부탁해</h1>
            <span>간편, 쉽고, 재밌는 시작!</span>
          </a>
        </div>
      </div>

      <div class="header-right">
        <!-- 로그인 유저 정보 -->
        <div class="profile_details">
          <ul>
	          <li class="dropdown profile_details_drop">
	            <a href="#" class="dropdown-toggle" 
	               data-toggle="dropdown" aria-expanded="false">
	              <div class="profile_img">
	                <span class="prfil-img">
	                  <img id="thumbnail" class="img-rounded" src="" alt=""> 
	                </span>
	                <div class="user-name">
	                  <p id="userNickname"></p>
	                  <span>안녕하세요.</span>
	                </div>
	                <!-- 빈칸 유지를 위한 아이콘 자리 -->
	                <i class="fa fa-angle-down lnr"></i> 
	                <i class="fa fa-angle-up lnr"></i>
	                <div class="clearfix"></div>
	              </div>
	            </a>
	            <ul class="dropdown-menu drp-mnu">
	              <li><a id="Mypage" href="#"><i class="fa fa-cog"></i>Mypage</a></li>
	              <li><a id="Logout" href="#"><i class="fa fa-sign-out"></i>Logout</a></li>
	            </ul>
	          </li>
          </ul>
        </div>
        <div class="clearfix"></div>
      </div>
      <div class="clearfix"></div>
    </div>
    <!-- //header-ends -->
    <script>
    $('#Mypage').click(function(event){
        location.href = "../mypage/mypage.html";
    });
    
    $('#Logout').click(function(event){
        event.preventDefault();
        sessionStorage.removeItem('loginUserNickname');
        sessionStorage.removeItem('loginUsercarNo');
        sessionStorage.removeItem('loginUserPhoto');
        location.href = "../auth/login.html";
      });
    </script>

    <div id="page-wrapper">
      <div>
        <h3 class="title">여기는 게시판 입니다!</h3>
        <h4>마음대로 떠들어보아요.</h4>
        <p>&nbsp;</p>
      </div>
      <div class="form-title" id="board-header">
        <span>
          <select id="category" class="form-control" onchange="search_cate()"> 
            <option value="">전체</option> 
            <option value="소모품">소모품</option>
            <option value="정비소">정비소</option>
          </select>
        </span>
        <span>
          <button id="writebtn" class="btn btn-primary" type="button">글쓰기</button>
        </span>
      </div>
      <div class="form-three widget-shadow">
	      <div class="panel-default">
		      <div class="main-page">
			      <div class="container" id="container">
			      </div>
		      </div>
	      </div>
      </div>
      <div class="form-title" id="board-footer">
        <ul class="pagination pagination-sm" id="document_navi3">
				  <li class="prev"><a href="#">&laquo;</a></li>
				  <li class="disabled prevx"><a href="#">&laquo;</a></li>
				  <span class="pageaction"></span>
				  <li class="num"><a href="#">{page}</a></li>
				  <li class="active now"><a href="#">{page} <span class="sr-only">(current)</span></a></li>
				  <li class="next"><a href="#">&raquo;</a></li>
				  <li class="disabled nextx"><a href="#">&raquo;</a></li>
				</ul>
				<div class="search_tool">
          <form class="input">
					  <button type="button" id="search_btn" class="btn btn-primary">검색</button>
						<div class="search-box">
	            <input class="sb-search-input input__field--madoka" placeholder="검색어를 입력해주세요." type="text" id="input-31" />
	            <label class="input__label" for="input-31">
	              <svg class="graphic" width="100%" height="100%" viewBox="0 0 404 77" preserveAspectRatio="none">
	                <path d="m0,0l404,0l0,77l-404,0l0,-77z"/>
	              </svg>
	            </label>
	            
		        </div>
          </form>
          <div>
            <select id="searchOption" class="form-control">
              <option value="title">제목</option>
              <option value="nickname">작성자</option>
            </select>
          </div>
	      </div>
        <div class="clearfix"> </div>
      </div>
    </div>
    
    <div class="footer">
      <p>
        &copy; 2016 Java76th 태웅 재한 영호 다인. All Rights Reserved | Project by <a href="" target="_blank">내 차를 부탁해</a>
      </p>
    </div>
  </div>
  <script>
  var menuLeft = document.getElementById('cbp-spmenu-s1'), 
      showLeftPush = document.getElementById('showLeftPush'), 
      body = document.body;

  showLeftPush.onclick = function() {
    classie.toggle(this, 'active');
    classie.toggle(body, 'cbp-spmenu-push-toright');
    classie.toggle(menuLeft, 'cbp-spmenu-open');
    disableOther('showLeftPush');
  };

  function disableOther(button) {
    if (button !== 'showLeftPush') {
      classie.toggle(showLeftPush, 'disabled');
    }
  }

  var page = document.location.search;
  page = page.replace("?", "");
  var keyword = sessionStorage.getItem('searchKeyword');
  var category = sessionStorage.getItem('searchCategory');
  
  if(category != null && keyword != null) {
	  var searchWord = sessionStorage.getItem('searchWord'); 
	  var url = '../community/ajax/search.do' + "?" + keyword + "=" + searchWord + "&category=" + category + "&" + page;
  } else if (category != null && keyword == null) {
		var url = '../community/ajax/search.do' + "?category=" + category + "&" + page;
  } else {
	  var searchKeyword = sessionStorage.getItem('searchKeyword');
	  var searchWord = sessionStorage.getItem('searchWord');
	  var url = '../community/ajax/search.do' + "?" + searchKeyword + "=" + searchWord + "&" + page;
  }

  $.getJSON(url, function(resultObj) {
    var container = $("#container");
    var selectMap = resultObj.pageAttribute;
    
    jQuery('#document_navi3').jaPageNavigator({
      page_row : selectMap.pageSize, // 보여질 게시물 목록 수
      page_link : selectMap.page_link, // 보여질 페이지 링크 수
      total_count : selectMap.count // 게시물 총 수
    });
    
    if (selectMap.count == 0) {
    	$("<ul>")
    	  .html("<li style='list-style-type: disc'>검색 조건에 맞는 게시물이 없습니다.</li>").appendTo(container);
    }
    
    for (var board of resultObj.data) {
      $("<div class='item block'>")
        .html("<div class='thumbs-wrapper'>" +
	              "<div class='thumbs'>" +
	                "<a class='detailLnk' href='#' boardNo='" + board.boardNo + "'>" +
	                  "<img src='../img/community/1.jpg'/>" +
	                "</a>" +
	              "</div>" +
	            "</div>" +
	            "<a class='detailLnk' href='#' boardNo='" + board.boardNo + "'>" +
	              "<h2 class='title'>"+ board.title + "</h2>" +
	            "</a>" +
	            "<p class='subline'>" + board.boardNo + "<span class='fancy'>&amp;</span>" + 
	            board.category + "<span class='fancy'>&amp;</span>" + board.nickname + "</p>"
        )
      .appendTo(container);
    }
 	  
 	  // 제목 링크에 클릭 이벤트 리스너를 등록한다.
 	  $("a.detailLnk").click(clickDetailLnk);
 	  
 	});
  
  $('#writebtn').click(function(event){
	    location.href = "communityForm.html";
  });
  
 	// 게시물 제목을 클릭했을 때 호출될 함수
 	function clickDetailLnk(event) {
 	  event.preventDefault(); 
 	  location.href = "communityDetail.html?no=" + $(this).attr("boardNo");
 	}
 
  $(document).keypress(function(e) {
      if (e.keyCode == 13)
          e.preventDefault();
  });
  $('#search_btn').click(searchEvent);
  $('#input-31').keyup(function(e) {
      if(e.keyCode == 13) searchEvent(); 
  });
  
  function searchEvent(event) {
    if($('#input-31').val().length < 1) {
      swal({    
        title: "검색 실패!",   
        text: "검색어를 입력해주세요!", 
        type: "error",
        confirmButtonText: "확인"
      });
      return false;
    }
    
    sessionStorage.setItem('searchKeyword', $('#searchOption').val());
    sessionStorage.setItem('searchWord', $('#input-31').val());
    
    location.href = 'communitySearch.html';
	}  
  
  function search_cate() {
    if ($('#category').val().length < 1) {
    	sessionStorage.removeItem('searchKeyword');
      sessionStorage.removeItem('searchWord');
 	    sessionStorage.removeItem('searchCategory');
    	location.href = 'community.html';
    	return false;
    }
    
    sessionStorage.removeItem('searchKeyword');
    sessionStorage.removeItem('searchWord');
    sessionStorage.setItem('searchCategory', $('#category').val());
    location.href = 'communitySearch.html';
  }
  </script>
  <script src="../js/main/jquery.nicescroll.js"></script>
  <script src="../js/main/scripts.js"></script>
</body>
</html>
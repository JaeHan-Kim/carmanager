<!DOCTYPE HTML>
<html>
<head>
<title>내 차를 부탁해 - 차량 등록 페이지</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords"
  content="Novus Admin Panel Responsive web template, Bootstrap Web Templates, Flat Web Templates, Android Compatible web template, 
SmartPhone Compatible web template, free WebDesigns for Nokia, Samsung, LG, SonyEricsson, Motorola web design" />
<script type="application/x-javascript">
  
addEventListener("load", function() { 
setTimeout(hideURLbar, 0); }, false); 
function hideURLbar(){ 
window.scrollTo(0,1); } 
</script>

<!-- Bootstrap Core CSS -->
<link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />
<link href="../css/main/bootstrap.css" rel='stylesheet' type='text/css' />
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.css" rel="stylesheet">
<!-- Custom CSS 메뉴바()메뉴내용, 상단, 차트박스, 글자색 스타일 -->
<link href="../css/main/style.css" rel='stylesheet' type='text/css' />
<!-- garage 에서 사용하는 CSS -->
<link href="../css/garage/garage.css" rel='stylesheet' type='text/css' />
<!-- font CSS -->
<!-- font-awesome icons 빈칸 유지를 위해 링크를 막아둠 -->
<!--<link href="../css/main/test/font-awesome.css" rel="stylesheet"> -->
<!-- //font-awesome icons -->

<!-- js-->
<script src="../js/main/jquery-1.11.1.min.js"></script>
<script src="../js/main/modernizr.custom.js"></script>
<!-- sweetAlert -->
<script type="text/javascript" src="../lib/sweetalert/sweetalert.min.js"></script>
<link rel="stylesheet" type="text/css"
  href="../lib/sweetalert/sweetalert.css">
<!--webfonts 없어도 되는듯.. 하지만 삭제 금지-->
<link
  href='//fonts.googleapis.com/css?family=Roboto+Condensed:400,300,300italic,400italic,700,700italic'
  rel='stylesheet' type='text/css'>
<!--//webfonts-->
<!--animate-->
<link href="../css/main/animate.css" rel="stylesheet" type="text/css"
  media="all">
<script src="../js/main/wow.min.js"></script>
<script>
  new WOW().init();
  $(document).ready(function(){ 
    var userNickname = sessionStorage.getItem('loginUserNickname')+ "님";
    var userCarNo = sessionStorage.getItem('selectCarNo');
    var userPhoto = sessionStorage.getItem('loginUserPhoto');
    $("#userNickname").html(userNickname);
    $("#thumbnail").attr("src", "../img/member/m-" + userPhoto + ".png");
 });  
</script>
<!--//end-animate-->

<!-- chart 챠트 -->
<script src="../lib/Chart.js/Chart.js"></script>
<!-- 차트에 날짜 데이터 이용하기 -->
<script src="../js/main/moment_local.js" type="text/javascript"></script>
<!-- //chart -->

<!-- Metis Menu -->
<script src="../js/main/metisMenu.min.js"></script>
<script src="../js/main/custom.js"></script>
<link href="../css/main/custom.css" rel="stylesheet">
<!--//Metis Menu -->
<!-- 차량 선택 라이브러리 -->
	<link rel="stylesheet" href="../css/main/default.css">
	<script src="../js/main/jquery.selecty.js"></script>
	<!-- // 차량 선택 라이브러리 -->
<!-- 차량등록 폼 -->
<link rel="stylesheet" type="text/css"
  href="../css/garage/tautocomplete.css" />
<script src="../js/garage/tautocomplete.js" type="text/javascript"></script>
<!-- 차량등록 폼 -->
</head>

<body class="cbp-spmenu-push">
  <div class="main-content">
    <!--left-fixed -navigation-->
    <div class=" sidebar" role="navigation">
      <div class="navbar-collapse">
        <nav class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left"
          id="cbp-spmenu-s1">
          <ul class="nav" id="side-menu">
            <li><a href="../main/main.html" class=""><i class="nav_icon"></i><img class="img_menu" src="../img/main/dash.png">Dashboard</a></li>
            <li><a href="../mypage/mypage.html" class=""><i class="nav_icon"></i><img class="img_menu" src="../img/main/mypage.png">My page</a></li>
            <li><a href="../garage/garage.html" class=""><i class="nav_icon"></i><img class="img_menu" src="../img/main/garage.png">차량 등록</a></li>
            <li><a href="../refuel/refuelManager.html" class=""><i class="nav_icon"></i><img class="img_menu" src="../img/main/refuel.png">차량 관리</a></li>
            <li><a href="../center/center.html" class=""><i class="nav_icon"></i><img class="img_menu" src="../img/main/center.png">정 비 소</a></li>
            <li><a href="../goods/goods.html" class=""><i class="nav_icon"></i><img class="img_menu" src="../img/main/goods.png">맞춤 서비스</a></li>
            <li><a href="../community/community.html" class=""><i class="nav_icon"></i><img class="img_menu" src="../img/main/community.png">커뮤니티</a></li>
          </ul>
          <!-- //sidebar-collapse -->
        </nav>
      </div>
    </div>
    <!--left-fixed -navigation-->

    <!-- header-starts -->
    <div class="sticky-header header-section ">
      <div class="header-left">
        <!--toggle button start-->
        <button id="showLeftPush">
          <img class="img_menubtn" src="../img/main/menu.png">
        </button>
        <!--toggle button end-->
        <!--logo -->
        <div class="logo">
          <a href="../main/main.html">
            <h1>내 차를 부탁해</h1> <span>간편, 쉽고, 재밌는 시작!</span>
          </a>
        </div>
        <!--//logo-->

        <div class="clearfix"> </div>

      </div>
      <!-- header-left end-->

      <!-- header-right -->
      <div class="header-right">
        <!-- 로그인 유저 정보 -->
        <div class="profile_details">
          <ul>
            <li class="dropdown profile_details_drop">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                <div class="profile_img">
                  <span class="prfil-img">
                  <img id="thumbnail" class="img-rounded" src="" alt=""> </span>
                  <div class="user-name">
                    <p id="userNickname"></p>
                    <span>반갑습니다 : )</span>
                  </div>
                  <!-- 빈칸 유지를 위한 아이콘 자리 -->
                  <i class="fa fa-angle-down lnr"></i>
                  <i class="fa fa-angle-up lnr"></i>
                  <div class="clearfix"></div>
                </div>
            </a>
            <!-- 유저별 차량 리스트 -->
              <ul id="myCarList" class="dropdown-menu drp-mnu">
              </ul>
            <!-- 유저별 차량 리스트 end -->
            </li>
          </ul>
        </div>
        <!-- 로그인 유저 정보 end -->
        <div class="clearfix"></div>
      </div>
      <!-- header-right -->
      <div class="clearfix"></div>
    </div>
    <!-- //header-ends -->
    <!-- 로그 아웃 클릭 이벤트 -->
    <script>
    $.getJSON('../main/list.do?no=' + sessionStorage.getItem("loginUser") + '&carNo='+sessionStorage.getItem("selectCarNo"), function(resultObj) {
      for (var garage of resultObj.data) {
        if (sessionStorage.getItem("selectCarNo") == garage.myCarNo) {
          /* alert(garage.nickName); */
          $('#selectedMyCar').html(garage.nickName);
        }
        $("<li><a class='link' href='#' carNo = '"+ garage.myCarNo +"' carName = '"+ garage.nickName +"'><i class='nav_icon'></i><img class='img_mycar' src='../img/main/mycar.png'>"+ garage.nickName +"</a></li>").appendTo('#myCarList');
     	} 
      $("<li><a class='link' carNo = 'Logout' href='#'><i class='nav_icon'></i><img class='img_logout' src='../img/main/logout.png'>Logout</a></li>").appendTo('#myCarList');
      $("a.link").click(clickLink);
   	});
    function clickLink(event) {
      event.preventDefault();
      /* alert($(event.target).attr("carName")); */
      if ($(event.target).attr("carNo") == 'Logout') {
          sessionStorage.removeItem('loginUserNickname');
      /*  sessionStorage.removeItem('loginUsercarNo'); */
          sessionStorage.removeItem('loginUserPhoto');
          sessionStorage.removeItem('selectCarNo');
          location.href = "../auth/login.html";
      } else {
        /* alert($(event.target).attr("carNo")); */
        $('#selectedMyCar').html($(event.target).attr("carName"));
        //alert($(event.target).attr("carNo"));
        sessionStorage.setItem('selectCarNo', $(this).attr("carNo"));
      }
        
    }
    </script>
    <!-- main content start-->
    <div id="page-wrapper">
      <div class="main-page">
        
        <h3 class="title1">차량을 등록하세요 :</h3>
        <h4>기본적인 정보만 받습니다. 불필요한 것은 모두 잊으세요.</h4>
        <p>&nbsp;</p>
        <!-- 각 페이지 안 컨텐츠 시작 부분(붙여 넣기할 때 div 묶인거 주의) -->
        <!-- 차량 리스트 출력 -->
        <div class="col-md-4 compose-left">

          <div class="folder widget-shadow">
            <ul id="carList">
              <li class="head">회원님의 차고 입니다(클릭하세요).</li>
            </ul>
          </div>

          <div class="chat-grid widget-shadow">
            <ul id="detail"></ul>
          </div>
          <div class="clearfix"></div>
          <div id="btn_msg" class="chat-grid">
            <!-- <button id='btn_delete' type="submit" class="btn btn-primary col-md-6" data-toggle="collapse" data-target="#btnMsg">차고에서 삭제하기</button> -->
            <button id='btn_delete2' type="submit" class="btn col-md-6" data-toggle="collapse" data-target="#btnMsg">차고에서 삭제하기</button>
          </div>

          <!-- 리스트 출력을 위한 스크립트 -->
          <script type="text/javascript">
            var myList = $("#carList");
            $.getJSON('list.do?no=' + sessionStorage.getItem("loginUser"), function(resultObj) {
              for (var garage of resultObj.data) {
              $("<li value='" + garage.myCarNo + "'><a class='detailLink' href='#' myCarNo='" + garage.myCarNo + "'><i class='nav_icon'></i><img class='img_mycar' src='../img/main/mycar.png'>" + garage.nickName + "</a></li>").appendTo(myList)
              }
              $("a.detailLink").click(clickDetailLink);
            });
            
           function clickDetailLink(event) {
             event.preventDefault(); 
             $(detail).empty();
             $.getJSON('detail.do?no='+ $(this).attr("myCarNo"), function(resultObj) {
              var ajaxResult = resultObj.ajaxResult;
              if (ajaxResult.status == "success") {
                 $("<li class='head'>차량 확인후 삭제하세요.</li>).appendTo(detail").appendTo(detail)
                 $("<li id='deleteNo' value='" + ajaxResult.data.myCarNo + "'><a href='#'><div class='chat-left'><label>애칭</label></div><div class='chat-right'><p>" + ajaxResult.data.nickName + "</p></div><div class='clearfix'></div></a></li>").appendTo(detail)
                 $("<li><a href='#'><div class='chat-left'><label>제조사</label></div><div class='chat-right'><p>" + ajaxResult.data.maker + "</p></div><div class='clearfix'></div></a></li>").appendTo(detail)  
                 $("<li><a href='#'><div class='chat-left'><label>모델명</label></div><div class='chat-right'><p>" + ajaxResult.data.model + " " +  ajaxResult.data.deailModel +"</p></div><div class='clearfix'></div></a></li>").appendTo(detail)
                 $("<li><a href='#'><div class='chat-left'><label>주행거리</label></div><div class='chat-right'><p>" + ajaxResult.data.mile + "</p></div><div class='clearfix'></div></a></li>").appendTo(detail) 
              }
             });
           }
           
            $('#btn_delete2').click(function(resultObj) {
              if ($('#deleteNo').val() == null) {
                swal("차량 선택 후 삭제하세요 ; (")
              } else {
              swal({   
                title: "정말 삭제하시겠습니까?",
                text: "차량을 삭제하면 기록한 정보가 모두 지워지며 복구가 불가능 합니다.",
                type: "warning",   
                showCancelButton: true,   
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "예 : )",   
                cancelButtonText: "아니오 : (",
                closeOnConfirm: false,   
                closeOnCancel: false }, 
                function(isConfirm){  
                  if (isConfirm) {
                    $.post('delete.do', {
                      no: $('#deleteNo').val(),
                      userNo: sessionStorage.getItem('loginUser')
                    }, function(resultObj) {
                      var ajaxResult = resultObj.ajaxResult;
                      if (ajaxResult.status == "success") {
                        swal({   
                          title: "삭제 성공!",   
                          text: "차량 등록 후 이용 가능합니다.",
                          type: "success",   
                          confirmButtonText: "확인" }, function() {
                            if($('#deleteNo').val() == sessionStorage.getItem("selectCarNo")) {
                              sessionStorage.setItem('selectCarNo', ajaxResult.data.myCarNo);
                            }
                            location.href = "garage.html";
                          });
                      } }, 'json');
                  } else {    
                      swal("취소하였습니다.", "기존 차량을 계속 이용합니다. : )", "error"); }
                });
              }
            });
         /*  $.getJSON('delete.do?no='+ $(event.target).attr("myCarNo"), function(resultObj) {
          location.href = "garage.html";
          }); */
          </script>
        </div>
        <!-- 리스트 출력 끝 -->

        <!-- 차량 등록폼 시작-->
        <div class="col-md-8 compose-right widget-shadow">
          <div class="panel-default">
            <div class="panel-heading">
            차고에 차량을 추가해 보세요.
            
             <div class="clearfix"></div>
           
            </div>
            </div>
            <div class="panel-body">
              <form id="form_carInput" class="com-mail">
                <div class="col-md-12">
                  <label>애칭</label> 
                  <input id="txt_nickname" type="text" class="form-control1 control3">
                  <label>제조사</label>
                  <select id="sel_list" class="form-control control3"></select>
                </div>
                <div id="div_modelinput" class="col-md-13">
                  <label>&nbsp;&nbsp;&nbsp;&nbsp;차량모델명</label>
                  <div class="col-md-12 grid_box1">
                    <input id="txt_modellist" type="text"
                      class="form-control1 control3">
                  </div>
                </div>
                <div id="div_modellist" class="col-md-13">
                  <label>&nbsp;&nbsp;&nbsp;&nbsp;차량모델명</label>
                  <div class="col-md-12 grid_box1">
                    <select id="sel_modellist" class="form-control control3"></select>
                  </div>
                </div>	
                <div class="col-md-12">
                  <label>세부 모델명</label> <input id="txt_trim" type="text"
                    class="form-control1 control3">
                </div>
                <div class="col-md-12">
                  <label for="txt_mile">주행거리</label> <input
                    id="txt_mile" type="text"
                    class="form-control1 control3">
                </div>
                <div class="col-md-12">
                  <label for="txt_effi">공인연비</label> <input
                    id="txt_effi" type="text"
                    class="form-control1 control3">
                </div>
                <label class="col-sm-2 control-label">연료종류</label>
                <div class="col-md-12">
                  <div class="radio-inline col-md-3">
                    <label><input type="radio" name="refuelType"
                      value="휘발유">휘발유</label>
                  </div>
                  <div class="radio-inline col-md-3">
                    <label><input type="radio" name="refuelType"
                      value="경유">경유</label>
                  </div>
                  <div class="radio-inline col-md-3">
                    <label><input type="radio" name="refuelType"
                      value="LPG">LPG</label>
                  </div>
                </div>
              </form>
            </div>
            <div class="panel-footer">
            	<span class="btn_set">
           			<button id="btn_reg" type="submit" class="btn_color btn btn-default">등록</button>
              	<button id="btn_reset" type="submit" class="btn_color btn btn-default">리셋</button>
            	</span>
            <div class="clearfix"></div>
            </div>
          </div>
        </div>
        <script type="text/javascript">
        //alert(sessionStorage.getItem("loginUser"));
        var makerList = $("#sel_list");
        var carList = $("#sel_modellist");
        
        $('#div_modellist').css('display', 'none');
        $('#div_modelinput').css('display', 'none');
        
        $.getJSON('makerlist.do', function(resultObj) {
        $("<option value='0'>제조사를 선택해 주세요.</option>").appendTo(makerList);
        $("<option value='0'>모델을 선택해 주세요.</option>").appendTo(carList);
          for(var maker of resultObj.makers) {
            $("<option value='"+ maker.makerNo + "'>"+maker.makerName+"</option>").appendTo(makerList);
          }
        });
        
        $("#sel_list").change(function(event){
          
          if ($("#sel_list").val() >= 1 && $("#sel_list").val() < 6) {
            $('#div_modellist').css('display', '');
            $('#div_modelinput').css('display', 'none');
          } else if ($("#sel_list").val() == 6) {
            $('#div_modellist').css('display', 'none');
            $('#div_modelinput').css('display', '');
          } else {
            $('#div_modellist').css('display', 'none');
            $('#div_modelinput').css('display', 'none');
          }
          $('#sel_modellist').empty();
         $("<option value='0'>모델을 선택해 주세요.</option>").appendTo('#sel_modellist');
          $.getJSON('modelsearch.do?no='+$("#sel_list").val(), function(resultObj) {
            for(var model of resultObj.datas) {
              $("<option value='"+ model.modelNo + "'>"+model.modelName+"</option>").appendTo(sel_modellist);
            }
          }); 
        });
        $("#sel_modellist").change(function(event){
          $.getJSON('refuellist.do?no='+$("#sel_modellist").val(), function(resultObj) {
           $('#txt_effi').val(resultObj.data.effi)
           if (resultObj.data.modelFuel == "휘발유") {
             $('input:radio[name=refuelType]')[0].checked = true;
           } else if (resultObj.data.modelFuel == "경유"){
             $('input:radio[name=refuelType]')[1].checked = true;
           } 
           else {
             $('input:radio[name=refuelType]')[2].checked = true;
           }
          }); 
        });
        $("#btn_reg").click(function(event){
          var detailModel = $('#txt_trim').val();
          var modelNo = $('#sel_modellist').val();
          if ($('#txt_nickname').val().length < 1) {
            swal({   
              title: "Error!",   
              text: "애칭을 입력해 주세요!", 
              type: "error",   
              confirmButtonText: "확인" });
            return false;
          }
          if ($('#sel_list').val() == 0) {
            swal({   
              title: "Error!",   
              text: "제조사를 입력해 주세요!",   
              type: "error",   
              confirmButtonText: "확인" });
            return false;
          }
          if ($('#sel_list').val() == 6) {
            if ($('#txt_modellist').val().length < 1) {
              swal({   
                title: "Error!",   
                text: "차량 모델명을 입력해 주세요!",   
                type: "error",   
                confirmButtonText: "확인" });
              return false;
            }
            modelNo = 1;
            detailModel = $('#txt_modellist').val() + " " + $('#txt_trim').val();
          } else if ($('#sel_modellist').val() == 0) {
            swal({   
              title: "Error!",   
              text: "차량 모델명을 입력해 주세요!",   
              type: "error",   
              confirmButtonText: "확인" });
              return false;
          }
          if ($('#txt_effi').val().length < 1) {
            swal({   
              title: "Error!",   
              text: "공인 연비를 입력해 주세요!",   
              type: "error",   
              confirmButtonText: "확인" });
            return false;
          }
          if ($('#txt_mile').val().length < 1) {
            swal({   
              title: "Error!",   
              text: "주행거리를 입력해 주세요!",   
              type: "error",   
              confirmButtonText: "확인" });
            return false;
          }
          if ($('input:radio[name=refuelType]:checked').val() == undefined) {
            swal({   
              title: "Error!",   
              text: "연료 종류 입력해 주세요!",   
              type: "error",   
              confirmButtonText: "확인" });
            return false;
          }
        $.post('addmycar.do', {
          memberNo: sessionStorage.getItem("loginUser"),
          modelNo: modelNo,
          nickName: $('#txt_nickname').val(),
          mile: $('#txt_mile').val(),
          effi: $('#txt_effi').val(),
          deailModel: detailModel
        }, function(resultObj) {
          var ajaxResult = resultObj.ajaxResult;
          if (ajaxResult.status == "failure") { 
            swal({   
              title: "Error!",   
              text: "차량은 최대 3대까지 등록 가능합니다.",   
              type: "error",   
              confirmButtonText: "확인 ;(" });
            return false;
          }
          swal({   
              title: "등록 성공!",   
              type: "success",   
              confirmButtonText: "확인 :)" }, function() {   
                if(sessionStorage.getItem("selectCarNo") == 0) {
                  alert(ajaxResult.data.myCarNo);
                  sessionStorage.setItem('selectCarNo', ajaxResult.data.myCarNo);
                }
                location.href = "garage.html";
              });
        }, 'json');
        });
        
        
        $("#btn_reset").click(function(event){
          $("#form_carInput").each(function() {  
            this.reset();
            $('#div_modellist').css('display', 'none');
            $('#div_modelinput').css('display', 'none');
         });  
        });
        </script>
        <!-- 차량 등록폼 끝 -->
        <div class="clearfix"></div>
      </div>
    </div>

    <!--footer-->
    <div class="footer">
      <p>
        &copy; 2016 Java76th 태웅 재한 영호 다인. All Rights Reserved | Project
        by <a href="" target="_blank">내 차를 부탁해</a>
      </p>
    </div>
    <!--//footer-->
  </div>

  <!-- Classie 메뉴 접히고 펼쳐지는 부분` -->
  <script src="../js/main/classie.js"></script>
  <script>
      var menuLeft = document.getElementById('cbp-spmenu-s1'), showLeftPush = document
          .getElementById('showLeftPush'), body = document.body;
      showLeftPush.onclick = function() {
        classie.toggle(this, 'active');
        classie.toggle(body, 'cbp-spmenu-push-toright');
        classie.toggle(menuLeft, 'cbp-spmenu-open');
        disableOther('showLeftPush');
      };
      function disableOther(button) {
        if (button !== 'showLeftPush') {
          classie.toggle(showLeftPush, 'disabled');
        }
      }
    </script>
  <!--scrolling js 스크롤바 조정-->
  <script src="../js/main/jquery.nicescroll.js"></script>
  <script src="../js/main/scripts.js"></script>
  <!--//scrolling js-->
  <!-- Bootstrap Core JavaScript -->
  <script src="../js/main/bootstrap.js">
      
    </script>
<!DOCTYPE HTML>
<!-- 현재 스크립트나 CSS 임포트는 각 기능이 있는 위치에 쓰여있기 때문에 
     실제로 사용할 때 정리해서 사용할 것을 권장합니다. -->
<html>
<head>
<title>new 내 차를 부탁해 - 차량 관리입니다.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<script type="application/x-javascript">
	  addEventListener("load", function() { 
	  setTimeout(hideURLbar, 0); }, false); 
	  function hideURLbar(){ 
	  window.scrollTo(0,1); } 
	</script>

	<!-- Bootstrap Core CSS -->
	<link type='text/css' rel='stylesheet' href="../css/main/bootstrap.css" />
	<!-- Custom CSS 메뉴바()메뉴내용, 상단, 차트박스, 글자색 스타일 -->
	<link type='text/css' rel='stylesheet' href="../css/main/style.css" />
	<!-- font CSS -->
	<!-- font-awesome icons 빈칸 유지를 위해 링크를 막아둠 -->
	<!--<link href="../css/main/test/font-awesome.css" rel="stylesheet"> -->
	<!-- //font-awesome icons -->
	<!-- js-->
	<script src="../js/main/jquery-1.11.1.min.js"></script>
	<script src="../js/main/modernizr.custom.js"></script>
	<!--webfonts 없어도 되는듯.. 하지만 삭제 금지-->
	<link type='text/css' rel='stylesheet'
	      href='//fonts.googleapis.com/css?family=Roboto+Condensed:400,300,300italic,400italic,700,700italic'>
	<!--//webfonts-->
  <!-- sweetAlert -->
  <script type="text/javascript" src="../lib/sweetalert/sweetalert.min.js"></script>
  <link rel="stylesheet" type="text/css" href="../lib/sweetalert/sweetalert.css">
	<!--animate-->
	<link type="text/css" rel="stylesheet" media="all" href="../css/main/animate.css" >
	<script src="../js/main/wow.min.js"></script>
	<script>
	  new WOW().init();
	  $(document).ready(function(){ 
	    var userNickname = sessionStorage.getItem('loginUserNickname')+ "님";
	    var userCarNo = sessionStorage.getItem('loginUsercarNo');
	    var userPhoto = sessionStorage.getItem('loginUserPhoto');
	    $("#userNickname").html(userNickname);
      $('#liter').css('display', 'none')
      $('#money').css('display', 'none')
      $("#thumbnail").attr("src", "../img/member/m-" + userPhoto + ".png");
      
      var selectCarNo = sessionStorage.getItem('selectCarNo');
      if (userCarNo == null) {  
        displayStatus(userCarNo);
      } else { 
        displayStatus(selectCarNo);    	  
      }

	  });
	</script>
	<!--//end-animate-->
	
	<!-- chart 챠트 -->
	<script src="../lib/Chart.js/Chart.js"></script>
	<!-- 차트에 날짜 데이터 이용하기 & 주유날짜 등록시 사용 -->
	<script type="text/javascript" src="../js/main/moment_local.js"></script>
	<!-- //chart -->
	
	<!-- Metis Menu -->
	<script src="../js/main/metisMenu.min.js"></script>
	<script src="../js/main/custom.js"></script>
	<link rel="stylesheet" href="../css/main/custom.css">
	<!--//Metis Menu -->
	
	<!-- 차량 선택 라이브러리 -->
	<link rel="stylesheet" href="../css/main/default.css">
	<script src="../js/main/jquery.selecty.js"></script>
	<!-- // 차량 선택 라이브러리 -->
</head>

<body class="cbp-spmenu-push">
  <div class="main-content">
    <!--left-fixed -navigation-->
    <div class=" sidebar" role="navigation">
      <div class="navbar-collapse">
        <nav class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left"
          id="cbp-spmenu-s1">
          <ul class="nav" id="side-menu">
            <li>
              <a href="../main/main.html" class="">
              <i class="fa fa-home nav_icon"></i>Dashboard</a>
            </li>
            <li>
              <a href="../mypage/mypage.html" class="">
              <i class="fa fa-home nav_icon"></i>My page</a>
            </li>
            <li>
              <a href="../garage/garage.html" class="">
              <i class="fa fa-home nav_icon"></i>차량 등록</a>
            </li>
            <li>
              <a href="../refuel/refuel.html" class="" style="color: #F2B33F;">
              <i class="fa fa-home nav_icon"></i>차량 관리</a>
            </li>
            <li>
              <a href="../center/center.html" class="">
              <i class="fa fa-home nav_icon"></i>정 비 소</a>
            </li>
            <li>
              <a href="../goods/goods.html" class="">
              <i class="fa fa-home nav_icon"></i>맞춤 서비스</a>
            </li>
            <li>
              <a href="../community/community.html" class="">
              <i class="fa fa-home nav_icon"></i>커뮤니티</a>
            </li>
          </ul>
          <!-- //sidebar-collapse -->
        </nav>
      </div>
    </div>
    <!--left-fixed -navigation-->

    <!-- header-starts -->
    <div class="sticky-header header-section ">
      <div class="header-left">
        <!--toggle button start-->
        <button id="showLeftPush">
          <img src="../img/main/menu.png">
        </button>
        <!--toggle button end-->
        <!--logo -->
        <div class="logo">
          <a href="../main/main.html">
            <h1>내 차를 부탁해</h1>
            <span>간편, 쉽고, 재밌는 시작!</span>
          </a>
        </div>
        <!--//logo-->

        <div class="clearfix"> </div>
      </div>
      <!-- header-left end-->

      <!-- header-right -->
      <div class="header-right">
        <!-- 유저별 차량 리스트 -->
          <div class="profile_details_left">
            <label id="selectCarTitle">&nbsp;&nbsp;* 현재 선택된 차량입니다 :&nbsp;</label>
            <div class="clearfix"></div>
             <select id="myCarList" class="selecty s2 selectCar" name="town" id="town">
             </select>
         </div>
        <!-- 유저별 차량 리스트 end -->
        
        <!-- 로그인 유저 정보 -->
        <div class="profile_details">
          <ul>
	          <li class="dropdown profile_details_drop">
	            <a href="#" class="dropdown-toggle" 
	               data-toggle="dropdown" aria-expanded="false">
	              <div class="profile_img">
	                <span class="prfil-img">
	                  <img id ="thumbnail" class="img-circle" src="" alt=""> 
	                </span>
	                <div class="user-name">
	                  <p id="userNickname"></p>
	                  <span>안녕하세요.</span>
	                </div>
	                <!-- 빈칸 유지를 위한 아이콘 자리 -->
	                <i class="fa fa-angle-down lnr"></i> 
	                <i class="fa fa-angle-up lnr"></i>
	                <div class="clearfix"></div>
	              </div>
	            </a>
	            <ul class="dropdown-menu drp-mnu">
	              <li><a id="Mypage" href="#"><i class="fa fa-cog"></i>Mypage</a></li>
	              <li><a id="Logout" href="#"><i class="fa fa-sign-out"></i>Logout</a></li>
	            </ul>
	          </li>
          </ul>
        </div>
        <!-- 로그인 유저 정보 end -->
        <div class="clearfix"></div>
      </div>
      <!-- header-right -->
      <div class="clearfix"></div>
    </div>
    <!-- //header-ends -->
     <!-- 로그 아웃 클릭 이벤트 -->
    <script>
    $.getJSON('../main/list.do?no=' + sessionStorage.getItem("loginUser") + '&carNo='+sessionStorage.getItem("selectCarNo"), function(resultObj) {
      for (var garage of resultObj.data) {
        $("<option value='"+ garage.myCarNo +"'>"+ garage.nickName +"</option>").appendTo('#myCarList');
     	}  
     
      $('#myCarList option[value='+ sessionStorage.getItem("selectCarNo") +']').attr('selected', 'selected');
      $('.selecty').selecty();
    });
    
    $('#Mypage').click(function(event){
      location.href = "../mypage/mypage.html";
 		});
    
    $('#Logout').click(function(event){
        event.preventDefault();
        sessionStorage.removeItem('loginUserNickname');
        sessionStorage.removeItem('loginUsercarNo');
        sessionStorage.removeItem('loginUserPhoto');
        location.href = "../auth/login.html";
      });
    </script>
    
    <script>
    $('#myCarList').change(function(){
      sessionStorage.setItem('selectCarNo', $("#myCarList").val());

      var userCarNo = sessionStorage.getItem('selectCarNo');
    
    	displayStatus(userCarNo);
    });
    
    function displayStatus(userCarNo) {
	    $.post('../mygoods/selectCurrentMile.do', {
	      no: userCarNo
	    }, function(resultObj) {
	      if (resultObj.status == "success") {
	    	  for (var i=1; i <= 9; i++) {
	    		  var restmile = resultObj.data[i];
	    	    var lifemile = $(".lbl_lifemile").eq(i-1).text();
	    	    var per = ((lifemile - restmile) / lifemile) * 100;
	    	    
 		    	  $(".lbl_txt14px").eq(i - 1).show();
   		    	$(".lbl_sign").eq(i-1).hide();
	    	    $(".lbl_restmile").eq(i - 1).text(restmile);
		      	$(".percent").eq(i - 1).text(parseInt(per) + '%');
		    	  $(".progress-bar").eq(i - 1).css('width', per + '%');
            if (resultObj.datadate != null) {
			    	  if (resultObj.datadate[i] == null) {
			    		  $(".lbl_changetxt").eq(i-1).hide();
			    		  $(".lbl_changedate").eq(i-1).text("");
			    	  } else {
			    		  $(".lbl_changetxt").eq(i-1).show();
			    		  $(".lbl_changedate").eq(i-1).text(resultObj.datadate[i]);
			    	  }
            } else {
            	$(".lbl_changetxt").eq(i-1).hide();
  	    		  $(".lbl_changedate").eq(i-1).text("");
            }
	    	  
          switch (true) {
            case per < 1 :
          	  $(".percent").eq(i - 1).text('0%');
              break;
            case per < 21 && 1 <= per:
          	  $(".progress-bar").eq(i - 1).css('background', 'url("../img/refuel/refuel_goods/stripes.png") #86e01e');
          	  break;
            case per < 41 && 21 <= per: 
          	  $(".progress-bar").eq(i - 1).css('background', 'url("../img/refuel/refuel_goods/stripes.png") #f2d31b');
          	  break;
            case per < 61 && 41 <= per: 
          	  $(".progress-bar").eq(i - 1).css('background', 'url("../img/refuel/refuel_goods/stripes.png") #f2b01e');
  		    	  break;
            case per < 81 && 61 <= per: 
          	  $(".progress-bar").eq(i - 1).css('background', 'url("../img/refuel/refuel_goods/stripes.png") #f27011');
  		    	  break;            	  
            case per < 100 && 81 <= per:
          	  $(".progress-bar").eq(i - 1).css('background', 'url("../img/refuel/refuel_goods/stripes.png") #f63a0f');
          	  break;
            default :
   		    	  $(".lbl_txt14px").eq(i - 1).hide();
   		    	  $(".lbl_sign").eq(i-1).show();
          	  $(".progress-bar").eq(i - 1).css('background', 'url("../img/refuel/refuel_goods/stripes.png") #f63a0f');
              $(".percent").eq(i - 1).text('');
   		    	  $(".progress-bar").eq(i - 1).css('width', '100%');
            }
          
	    	  }
	    	  
	      }
	    }, 'json')
	      
	  };  
    </script>
    
    <!-- main content start-->
    <div id="page-wrapper">
      <div class="main-page">

	    <!-- 각 페이지 안 컨텐츠 시작 부분(붙여 넣기할 때 div 묶인거 주의) -->
	      <div class="forms validation">
				  <h3 class="title1">차량 관리를 시작하세요 :</h3>
	        <div class="widget_1 row elements">

            <div
              class="col-sm-4 widget_1_box widget-mdl-grid widget-shadow">
              <a href="refuel.html">
                <div class="tile-progress bg-success">
                  <div class="content">
                    <h4>
                      <i class="fa fa-dashboard icon-sm"></i> 주유 기록 등록하기
                    </h4>
                    <span>:&nbsp;&nbsp;자세한 분석을 원하시면 주행거리, 단가를 입력하세요.</span>
                  </div>
                </div>
              </a>
            </div>

            <div
              class="col-sm-4 widget_1_box widget-mdl-grid widget-shadow">
              <a href="refuel_goods.html">
                <div class="tile-progress bg-danger">
                  <div class="content">
                    <h4>
                      <i class="fa fa-dashboard icon-sm"></i> 소모품 관리하기
                    </h4>
                    <span>:&nbsp;&nbsp;거리 대비 소모품 교체 시기를 보여 드립니다. 교체하셨다면 교체 확인을 하세요.</span>
                  </div>
                </div>
              </a>
            </div>
            <div class="clearfix"></div>
          </div>
	     
	   <link rel="stylesheet" href="../css/refuel/refuel_goods.css">	   
     <!--소모품 프로그래스바 시작 -->
        <div class=" form-grids row">
						<div class="widget-shadow " data-example-id="basic-forms"> 
							<div class="form-title2">
								<h4>: 소모품 상태를 확인하세요.</h4>
							</div>
							<div class="form-body">

							  <div class="tab-pane active" id="domprogress">
							    <div class="single-bottom">
									
									  <ul id="goodsList">
										  <li>
										    <img class="img_goods" src="../img/refuel/refuel_goods/wiper.png"/>&nbsp;
										    <label class="lbl_goods">와이퍼 블레이드</label><br>
										    <label class="lbl_lifemile">8000</label><label class="lbl_txt12px"> km 주기</label><label class="lbl_changetxt">마지막 교체 날짜 : <span><label class="lbl_changedate">0000-00-00</label></span></label><br>
										    
										    <div class="progress">
											    <div class="progress-bar"></div>
											    <label class="percent"></label>
										    </div>
										    
										    <input type="button" value="교체" class="btn_color btn btn-default btn_reset">
									      <label class="lbl_txt14px">다음 정비까지 <span><label class="lbl_restmile">0</label></span> km 남았습니다.</label>
									      <label class="lbl_sign" hidden="true">점검이 필요한 소모품입니다.</label>
								      </li>
	                  
										  <li>
										    <img class="img_goods" src="../img/refuel/refuel_goods/filter.png"/>&nbsp;
										    <label class="lbl_goods">에어컨필터</label><br>
										    <label class="lbl_lifemile">5000</label><label class="lbl_txt12px"> km 주기</label><label class="lbl_changetxt">마지막 교체 날짜 : <span><label class="lbl_changedate">0000-00-00</label></span></label><br>
										    
										    <div class="progress">
											    <div class="progress-bar"></div>
											    <label class="percent"></label>
										    </div>
										    
										    <input type="button" value="교체" class="btn_color btn btn-default btn_reset">
									      <label class="lbl_txt14px">다음 정비까지 <span><label class="lbl_restmile">0</label></span> km 남았습니다.</label>
									      <label class="lbl_sign" hidden="true">점검이 필요한 소모품입니다.</label>
								      </li>
	                  
										  <li>
										    <img class="img_goods" src="../img/refuel/refuel_goods/breakpad.png"/>&nbsp;
										    <label class="lbl_goods">브레이크 패드</label><br>
										    <label class="lbl_lifemile">30000</label><label class="lbl_txt12px"> km 주기</label><label class="lbl_changetxt">마지막 교체 날짜 : <span><label class="lbl_changedate">0000-00-00</label></span></label><br>
										    
										    <div class="progress">
											    <div class="progress-bar"></div>
											    <label class="percent"></label> 
										    </div>
										    
										    <input type="button" value="교체" class="btn_color btn btn-default btn_reset">
									      <label class="lbl_txt14px">다음 정비까지 <span><label class="lbl_restmile">0</label></span> km 남았습니다.</label>
									      <label class="lbl_sign" hidden="true">점검이 필요한 소모품입니다.</label>
								      </li>
	                  
										  <li>
										    <img class="img_goods" src="../img/refuel/refuel_goods/breakoil.png"/>&nbsp;
										    <label class="lbl_goods">브레이크 오일</label><br>
										    <label class="lbl_lifemile">45000</label><label class="lbl_txt12px"> km 주기</label><label class="lbl_changetxt">마지막 교체 날짜 : <span><label class="lbl_changedate">0000-00-00</label></span></label><br>
										    
										    <div class="progress">
											    <div class="progress-bar"></div>
											    <label class="percent"></label>
										    </div>
										    
										    <input type="button" value="교체" class="btn_color btn btn-default btn_reset">
									      <label class="lbl_txt14px">다음 정비까지 <span><label class="lbl_restmile">0</label></span> km 남았습니다.</label>
									      <label class="lbl_sign" hidden="true">점검이 필요한 소모품입니다.</label>
								      </li>
	                  
										  <li>
										    <img class="img_goods" src="../img/refuel/refuel_goods/coolant.png"/>&nbsp;
										    <label class="lbl_goods">부동액</label><br>
										    <label class="lbl_lifemile">40000</label><label class="lbl_txt12px"> km 주기</label><label class="lbl_changetxt">마지막 교체 날짜 : <span><label class="lbl_changedate">0000-00-00</label></span></label><br>
										    
										    <div class="progress">
											    <div class="progress-bar"></div>
											    <label class="percent"></label> 
										    </div>
										    
										    <input type="button" value="교체" class="btn_color btn btn-default btn_reset">
									      <label class="lbl_txt14px">다음 정비까지 <span><label class="lbl_restmile">0</label></span> km 남았습니다.</label>
									      <label class="lbl_sign" hidden="true">점검이 필요한 소모품입니다.</label>
								      </li>
	                  
										  <li>
										    <img class="img_goods" src="../img/refuel/refuel_goods/engine.png"/>&nbsp;
										    <label class="lbl_goods">엔진 오일</label><br>
										    <label class="lbl_lifemile">10000</label><label class="lbl_txt12px"> km 주기</label><label class="lbl_changetxt">마지막 교체 날짜 : <span><label class="lbl_changedate">0000-00-00</label></span></label><br>
										    
										    <div class="progress">
											    <div class="progress-bar"></div>
											    <label class="percent"></label> 
										    </div>
										    
										    <input type="button" value="교체" class="btn_color btn btn-default btn_reset">
									      <label class="lbl_txt14px">다음정비까지 <span><label class="lbl_restmile">0</label></span> km 남았습니다.</label>
									      <label class="lbl_sign" hidden="true">점검이 필요한 소모품입니다.</label>
								      </li>
	                  
										  <li>
										    <img class="img_goods" src="../img/refuel/refuel_goods/missionoil.png"/>&nbsp;
										    <label class="lbl_goods">미션 오일</label><br>
										    <label class="lbl_lifemile">50000</label><label class="lbl_txt12px"> km 주기</label><label class="lbl_changetxt">마지막 교체 날짜 : <span><label class="lbl_changedate">0000-00-00</label></span></label><br>
										    
										    <div class="progress">
											    <div class="progress-bar"></div>
											    <label class="percent"></label> 
										    </div>
										    
										    <input type="button" value="교체" class="btn_color btn btn-default btn_reset">
									      <label class="lbl_txt14px">다음 정비까지 <span><label class="lbl_restmile">0</label></span> km 남았습니다.</label>
									      <label class="lbl_sign" hidden="true">점검이 필요한 소모품입니다.</label>
								      </li>
	                  
										  <li>
										    <img class="img_goods" src="../img/refuel/refuel_goods/tire.png"/>&nbsp;
										    <label class="lbl_goods">타이어</label><br>
										    <label class="lbl_lifemile">60000</label><label class="lbl_txt12px"> km 주기</label><label class="lbl_changetxt">마지막 교체 날짜 : <span><label class="lbl_changedate">0000-00-00</label></span></label><br>
										  
										    <div class="progress">
											    <div class="progress-bar"></div>
											    <label class="percent"></label> 
										    </div>
										   
										    <input type="button" value="교체" class="btn_color btn btn-default btn_reset">
									      <label class="lbl_txt14px">다음 정비까지 <span><label class="lbl_restmile">0</label></span> km 남았습니다.</label>
									      <label class="lbl_sign" hidden="true">점검이 필요한 소모품입니다.</label>
								      </li>
	                  
										  <li>
										    <img class="img_goods" src="../img/refuel/refuel_goods/battery.png"/>&nbsp;
										    <label class="lbl_goods">배터리</label><br>
										    <label class="lbl_lifemile">60000</label><label class="lbl_txt12px"> km 주기</label><label class="lbl_changetxt">마지막 교체 날짜 : <span><label class="lbl_changedate">0000-00-00</label></span></label><br>
										    
										    <div class="progress">
											    <div class="progress-bar"></div>
											    <label class="percent"></label> 
										    </div>
										    
										    <input type="button" value="교체" class="btn_color btn btn-default btn_reset">
									      <label class="lbl_txt14px">다음 정비까지 <span><label class="lbl_restmile">0</label></span> km 남았습니다.</label>
									      <label class="lbl_sign" hidden="true">점검이 필요한 소모품입니다.</label>
								      </li>
							      </ul>
                  </div>							  
								</div>
							</div>
						</div>
					</div>
   
      </div>
    </div>
    
    <script>
      $("#goodsList").on("click",".btn_reset", function(e) {
    	  var now = new Date();
        var year= now.getFullYear();
        var mon = (now.getMonth()+1)>9 ? ''+(now.getMonth()+1) : '0'+(now.getMonth()+1);
        var day = now.getDate()>9 ? ''+now.getDate() : '0'+now.getDate();
                
        var chan_val = year + '-' + mon + '-' + day;
    	  
		    $(".lbl_txt14px").eq($(this).parent().index()).show();
   		  $(".lbl_sign").eq($(this).parent().index()).hide();
      	$(".percent").eq($(this).parent().index()).text('0%');
    	  $(".progress-bar").eq($(this).parent().index()).css('width', '0%');
				$(".lbl_restmile").eq($(this).parent().index()).text($(".lbl_lifemile").eq($(this).parent().index()).text());
		    $(".lbl_changetxt").eq($(this).parent().index()).show();
	      $(".lbl_changedate").eq($(this).parent().index()).text(chan_val);

    	  $.post('../mygoods/update.do', {
				  garageNo: sessionStorage.getItem('selectCarNo'),
				  goodsNo: $(this).parent().index() + 1		
			  }, function(resultObj){
				  var ajaxResult = resultObj.ajaxResult;
				  if (ajaxResult.status == "success") {
				    console.log("교체 기록에 추가 되었습니다.");
				  }
			  }, 'json');
    	  
      }); 
    </script>
     
    <!--footer-->
    <div class="footer">
      <p>
        &copy; 2016 Java76th 태웅 재한 영호 다인. All Rights Reserved | Project by <a href="" target="_blank">내 차를 부탁해</a>
      </p>
    </div>
    <!--//footer-->
  </div>

  <!-- Classie 메뉴 접히고 펼쳐지는 부분` -->
  <script src="../js/main/classie.js"></script>
  <script>
    var menuLeft = document.getElementById('cbp-spmenu-s1'), 
        showLeftPush = document.getElementById('showLeftPush'), 
        body = document.body;

    showLeftPush.onclick = function() {
      classie.toggle(this, 'active');
      classie.toggle(body, 'cbp-spmenu-push-toright');
      classie.toggle(menuLeft, 'cbp-spmenu-open');
      disableOther('showLeftPush');
    };

    function disableOther(button) {
      if (button !== 'showLeftPush') {
        classie.toggle(showLeftPush, 'disabled');
      }
    }
  </script>
  <!--scrolling js 스크롤바 조정-->
  <script src="../js/main/jquery.nicescroll.js"></script>
  <script src="../js/main/scripts.js"></script>
  <!--//scrolling js-->
  <!-- Bootstrap Core JavaScript -->
  <script src="../js/main/bootstrap.js"></script>
</body>
</html>
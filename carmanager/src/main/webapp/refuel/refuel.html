<!DOCTYPE HTML>
<!-- 현재 스크립트나 CSS 임포트는 각 기능이 있는 위치에 쓰여있기 때문에 
     실제로 사용할 때 정리해서 사용할 것을 권장합니다. -->
<html>
<head>
<title>new 내 차를 부탁해 - 차량 관리입니다.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<script type="application/x-javascript">
	  addEventListener("load", function() { 
	  setTimeout(hideURLbar, 0); }, false); 
	  function hideURLbar(){ 
	  window.scrollTo(0,1); } 
	</script>

	<!-- Bootstrap Core CSS -->
	<link type='text/css' rel='stylesheet' href="../css/main/bootstrap.css" />
	<!-- Custom CSS 메뉴바()메뉴내용, 상단, 차트박스, 글자색 스타일 -->
	<link type='text/css' rel='stylesheet' href="../css/main/style.css" />
	<!-- font CSS -->
	<!-- font-awesome icons 빈칸 유지를 위해 링크를 막아둠 -->
	<!--<link href="../css/main/test/font-awesome.css" rel="stylesheet"> -->
	<!-- //font-awesome icons -->
	<!-- js-->
	<script src="../js/main/jquery-1.11.1.min.js"></script>
	<script src="../js/main/modernizr.custom.js"></script>
	<!--webfonts 없어도 되는듯.. 하지만 삭제 금지-->
	<link type='text/css' rel='stylesheet'
	      href='//fonts.googleapis.com/css?family=Roboto+Condensed:400,300,300italic,400italic,700,700italic'>
	<!--//webfonts-->
  <!-- sweetAlert -->
  <script type="text/javascript" src="../lib/sweetalert/sweetalert.min.js"></script>
  <link rel="stylesheet" type="text/css" href="../lib/sweetalert/sweetalert.css">
	<!--animate-->
	<link type="text/css" rel="stylesheet" media="all" href="../css/main/animate.css" >
	<script src="../js/main/wow.min.js"></script>
	<script>
	  new WOW().init();
	  $(document).ready(function(){ 
	    var userNickname = sessionStorage.getItem('loginUserNickname')+ "님";
	    var userCarNo = sessionStorage.getItem('loginUsercarNo');
	    var userPhoto = sessionStorage.getItem('loginUserPhoto');
	    $("#userNickname").html(userNickname);
      $('#liter').css('display', 'none')
      $('#money').css('display', 'none')
      $('#updateForm').css('display', 'none')
      $("#thumbnail").attr("src", "../img/member/m-" + userPhoto + ".png");
	 });  
	</script>
	<!--//end-animate-->
	
	<!-- chart 챠트 -->
	<script src="../lib/Chart.js/Chart.js"></script>
	<!-- 차트에 날짜 데이터 이용하기 & 주유날짜 등록시 사용 -->
	<script type="text/javascript" src="../js/main/moment_local.js"></script>
	<!-- //chart -->
	
	<!-- Metis Menu -->
	<script src="../js/main/metisMenu.min.js"></script>
	<script src="../js/main/custom.js"></script>
	<link rel="stylesheet" href="../css/main/custom.css">
	<!--//Metis Menu -->
  
  <!-- 달력 선택 -->
  <script src="../js/refuel/simplecalendar.js" type="text/javascript"></script>
  <link rel="stylesheet" href="../css/refuel/refuel.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lato:300,400,700">
  <link rel="stylesheet" href="http://weloveiconfonts.com/api/?family=fontawesome">
  <!-- //달력 선택 -->
  <!-- 차량 선택 라이브러리 -->
	<link rel="stylesheet" href="../css/main/default.css">
	<script src="../js/main/jquery.selecty.js"></script>
	<!-- // 차량 선택 라이브러리 -->
</head>

<body class="cbp-spmenu-push">
  <div class="main-content">
    <!--left-fixed -navigation-->
    <div class=" sidebar" role="navigation">
      <div class="navbar-collapse">
        <nav class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left"
          id="cbp-spmenu-s1">
          <ul class="nav" id="side-menu">
            <li><a href="../main/main.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/dash.png">Dashboard</a></li>
            <li><a href="../mypage/mypage.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/mypage.png">My page</a></li>
            <li><a href="../garage/garage.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/garage.png">차량 등록</a></li>
            <li><a href="../refuel/refuel.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/refuel.png">차량 관리</a></li>
            <li><a href="../center/center.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/center.png">정 비 소</a></li>
            <li><a href="../goods/goods.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/goods.png">맞춤 서비스</a></li>
            <li><a href="../community/community.html" class=""><i class="fa fa-home nav_icon"></i><img class="img_menu" src="../img/main/community.png">커뮤니티</a></li>
          </ul>
          <!-- //sidebar-collapse -->
        </nav>
      </div>
    </div>
    <!--left-fixed -navigation-->

    <!-- header-starts -->
    <div class="sticky-header header-section ">
      <div class="header-left">
        <!--toggle button start-->
        <button id="showLeftPush">
          <img class="img_menubtn" src="../img/main/menu.png">
        </button>
        <!--toggle button end-->
        <!--logo -->
        <div class="logo">
          <a href="../main/main.html">
            <h1>내 차를 부탁해</h1>
            <span>간편, 쉽고, 재밌는 시작!</span>
          </a>
        </div>
        <!--//logo-->

        <div class="clearfix"> </div>
      </div>
      <!-- header-left end-->

      <!-- header-right -->
      <div class="header-right">
        <!-- 유저별 차량 리스트 -->
          <div class="profile_details_left">
            <label id="selectCarTitle">&nbsp;&nbsp;* 현재 선택된 차량입니다 :&nbsp;</label>
            <div class="clearfix"></div>
              <select id="myCarList" class="selecty s2 selectCar" name="town" id="town">
              </select>
         </div>
        <!-- 유저별 차량 리스트 end -->
        <!-- 로그인 유저 정보 -->
        <div class="profile_details">
          <ul>
	          <li class="dropdown profile_details_drop">
	            <a href="#" class="dropdown-toggle" 
	               data-toggle="dropdown" aria-expanded="false">
	              <div class="profile_img">
	                <span class="prfil-img">
	                  <img id ="thumbnail" class="img-circle" src="" alt=""> 
	                </span>
	                <div class="user-name">
	                  <p id="userNickname"></p>
	                  <span>안녕하세요.</span>
	                </div>
	                <!-- 빈칸 유지를 위한 아이콘 자리 -->
	                <i class="fa fa-angle-down lnr"></i> 
	                <i class="fa fa-angle-up lnr"></i>
	                <div class="clearfix"></div>
	              </div>
	            </a>
	            <ul class="dropdown-menu drp-mnu">
	              <li><a id="Mypage" href="#"><i class="fa fa-cog"></i>Mypage</a></li>
	              <li><a id="Logout" href="#"><i class="fa fa-sign-out"></i>Logout</a></li>
	            </ul>
	          </li>
          </ul>
        </div>
        <!-- 로그인 유저 정보 end -->
        <div class="clearfix"></div>
      </div>
      <!-- header-right -->
      <div class="clearfix"></div>
    </div>
    <!-- //header-ends -->
     <!-- 로그 아웃 클릭 이벤트 -->
    <script>
    $.getJSON('../main/list.do?no=' + sessionStorage.getItem("loginUser") + '&carNo='+sessionStorage.getItem("selectCarNo"), function(resultObj) {
      /* alert(sessionStorage.getItem('loginUsercarNo')); */
      for (var garage of resultObj.data) {
        $("<option value='"+ garage.myCarNo +"'>"+ garage.nickName +"</option>").appendTo('#myCarList');
    	} 
    	$('#myCarList option[value='+ sessionStorage.getItem("selectCarNo") +']').attr('selected', 'selected');
    	$('.selecty').selecty();
   	});
    $('#myCarList').change(function(){
     	sessionStorage.setItem('selectCarNo', $("#myCarList").val());
    });
    $('#Mypage').click(function(event){
      location.href = "../mypage/mypage.html";
 		});
    
    $('#Logout').click(function(event){
        event.preventDefault();
        sessionStorage.removeItem('loginUserNickname');
        sessionStorage.removeItem('selectCarNo');
        sessionStorage.removeItem('loginUserPhoto');
        location.href = "../auth/login.html";
      });
    </script>
    <!-- main content start-->
    <div id="page-wrapper">
      <div class="main-page">

    <!-- 주유기록 & 소모품 관리 -->
        <div class="forms validation">
          <h3 class="title1">차량 관리를 시작하세요 :</h3>

          <div class="widget_1 row elements">

            <div class="col-sm-4 widget_1_box widget-mdl-grid widget-shadow">
              <a href="refuel.html">
                <div class="tile-progress bg-success">
                  <div class="content">
                    <h4>
                      <i class="fa fa-dashboard icon-sm"></i> 주유 기록 등록하기
                    </h4>
                    <span>:&nbsp;&nbsp;자세한 분석을 원하시면 주행거리, 단가를 입력하세요.</span>
                  </div>
                </div>
              </a>
            </div>

            <div
              class="col-sm-4 widget_1_box widget-mdl-grid widget-shadow">
              <a href="refuel_goods.html">
                <div class="tile-progress bg-danger">
                  <div class="content">
                    <h4>
                      <i class="fa fa-dashboard icon-sm"></i> 소모품 관리하기
                    </h4>
                    <span>:&nbsp;&nbsp;거리 대비 소모품 교체 시기를 보여 드립니다. 교체하셨다면 교체 확인을 하세요.</span>
                  </div>
                </div>
              </a>
            </div>
            <div class="clearfix"></div>
          </div>


          <!-- 주유기록 등록 폼 -->
          <div class="row">

            <!-- 등록 폼 -->
            <div id="addForm" class="col-md-6 validation-grids widget-shadow" data-example-id="basic-forms">
              <div class="form-title">
                <h4>: 주유 내역을 기록하세요.</h4>
              </div>
              <div class="form-body">
                <form method="post" name="addRefuel" data-toggle="validator" novalidate>
                  <div class="form-group">
                    &nbsp;&nbsp;주유 날짜 : <input type="date" name="refuelDate" id="date_refuelDate" class="form-control" placeholder="">
                  </div>
                  <div class="form-group has-feedback">
                   &nbsp;&nbsp;예상 주행거리 : 
                     <input class="form-control" id="num_driveMile" readonly>
                    <span class="help-block with-errors">
                    현재 주행거리를 입력하세요.<br>잊으셨다면 저번 주유량을 바탕으로 한 예상 주행거리를 입력합니다.</span>
                     <input type="number" name="mile" id="num_userMile" class="form-control" placeholder="주행 거리를 입력하세요.">
                  </div>
                  <div class="form-group">
                    <div id="sMoney" class="radio">
                      <label> <input type="radio" name="gender" required>단가 + 금액 기록</label>
                    </div>
                    <div id="sLiter" class="radio">
                      <label> <input type="radio" name="gender" required>단가 + 주유량 기록</label>
                    </div>
                    <p>&nbsp;&nbsp;</p>
                      &nbsp;&nbsp;단가 : (원)<input id="num_literCost" name="literCost" type="number" class="form-control" id="inputName" required>
                      <span class="help-block with-errors">
                      단가를 잊으셨나요? 현재 전국평균 가격을 넣어드립니다. 자세한 분석을 원하시면 정확한 가격을 입력하세요.</span>
                    <div id="money" class="form-group">
                      &nbsp;&nbsp;금액 : <input id="num_cost" name="cost" type="number" class="form-control" id="inputName" placeholder="주유한 금액을 입력하세요. (원)" required>
                    </div>
                    <div id="liter" class="form-group">
                      &nbsp;&nbsp;주유량 : <input id="num_liter" name="liter" type="number" class="form-control" id="inputName" placeholder="주유한 양을 입력하세요. (리터)" required>
                    </div>
                  </div>
                  <div class="form-group">
                    <button id="btn_addRefuel" type="button" class="btn btn-primary save">주유내역 등록하기</button>
                  </div>
                </form>
                </div>
               </div>
               
                <!-- 업데이트 폼 -->
               <div id="updateForm" class="col-md-6 validation-grids widget-shadow" data-example-id="basic-forms">
                <div class="form-title">
                  <h4>: 주유 기록을 수정하세요.</h4>
                </div>
                <div class="form-body">
                <form method="post" name="addRefuel" data-toggle="validator" novalidate>
                  <div class="form-group">
                    &nbsp;&nbsp;주유한 날짜 : <input type="date" name="refuelDate" id="date_refuelDateUP" class="form-control" placeholder="">
                  </div>
                  <div class="form-group has-feedback">
                   &nbsp;&nbsp;기록된 주행거리 : 
                     <input class="form-control" id="num_driveMileUP" readonly>
                    <span class="help-block with-errors">
                    수정할 주행거리를 입력하세요.<br>누적된 주행거리를 낮추거나 높일 수는 없습니다.<br>(주의! 구간 연비가 조정됩니다)</span>
                     <input type="number" name="mile" id="num_userMileUP" class="form-control" placeholder="수정할 주행 거리를 입력하세요.">
                  </div>
                  <div class="form-group">
                    <div id="sMoneyUP" class="radio">
                      <label> <input type="radio" name="gender" required>단가 + 금액 기록</label>
                    </div>
                    <div id="sLiterUP" class="radio">
                      <label> <input type="radio" name="gender" required>단가 + 주유량 기록</label>
                    </div>
                    <p>&nbsp;&nbsp;</p>
                      &nbsp;&nbsp;단가 : (원)<input id="num_literCost" name="literCost" type="number" class="form-control" id="inputName" required>
                      <span class="help-block with-errors">
                      단가를 잊으셨나요? 현재 전국평균 가격을 넣어드립니다. 자세한 분석을 원하시면 정확한 가격을 입력하세요.</span>
                    <div id="moneyUP" class="form-group">
                      &nbsp;&nbsp;금액 : <input id="num_cost" name="cost" type="number" class="form-control" id="inputName" placeholder="주유한 금액을 입력하세요. (원)" required>
                    </div>
                    <div id="literUP" class="form-group">
                      &nbsp;&nbsp;주유량 : <input id="num_liter" name="liter" type="number" class="form-control" id="inputName" placeholder="주유한 양을 입력하세요. (리터)" required>
                    </div>
                  </div>
                  <div class="form-group">
                    <button id="btn_updateRefuel" type="button" class="btn btn-primary save">주유내역 수정하기</button>
                  </div>
                </form>
              </div>
            </div>
            <!-- 기록 선택별 input 타입 지정 스트립트 -->
            <script>
              $('#sMoney').click(function(event) {
                $('#money').css('display', '')
                $('#liter').css('display', 'none')
              });
              $('#sLiter').click(function(event) {
                $('#money').css('display', 'none')
                $('#liter').css('display', '')
              });
            </script>
            <!-- 주유기록 리스트 스크립트 -->
            <script type="text/javascript">
              var today = moment().format('YYYY-MM-DD');
              var userCarNo = sessionStorage.getItem('loginUsercarNo');
              var predictMile = null;
             //  alert(userCarNo); 
              $.getJSON('list.do?no=' + userCarNo, function(resultObj) {
                var ajaxResult = resultObj.ajaxResult;
                var refuel = ajaxResult.data;
                var fuelName = refuel.fuelName;
               //alert(fuelName);
               // alert(ajaxResult.data.refuelNo);
                 if (ajaxResult.status == "success") {
                  $("#date_refuelDate").val(today);
                  predictMile = Math.round(refuel.mile + ((refuel.cost/refuel.literCost) * refuel.effi))
                  $("#num_driveMile").val(predictMile);
                } else if (ajaxResult.status == "failure") {
                  swal("첫 주유 기록이시군요?", "첫 주유기록 이후부터는 편리하게 입력하실 수 있습니다.")
                  $("#date_refuelDate").val(today);
                }
                 
                  $.getJSON('http://localhost:8989/oil', function(resultObj) {
                	/* alert("휘발유 : " + Math.round(resultObj.result.Oil[1].PRICE));
                	alert("경유 : " + Math.round(resultObj.result.Oil[2].PRICE));
                	alert("LGP : " + Math.round(resultObj.result.Oil[4].PRICE)); */
                	if (fuelName == "휘발유") {
                      $("#num_literCost").val(Math.round(resultObj.result.Oil[1].PRICE));
                	} else if (fuelName == "경유") {
                	  $("#num_literCost").val(Math.round(resultObj.result.Oil[2].PRICE));
                	} else {
                	  $("#num_literCost").val(Math.round(resultObj.result.Oil[4].PRICE));
                	}
                  });
              });
            </script>
            <!-- 주유기록 등록 -->
            <script>
            var liter = null;
            var cost = null;
            var mile = null;
            var date = null;
              $("#btn_addRefuel").click(function(event){
                if ($('input:radio[name=gender]')[0].checked) {
                   liter = (Number($('#num_cost').val()) / Number($('#num_literCost').val())).toFixed(2);
                   cost = $('#num_cost').val();
                } else if ($('input:radio[name=gender]')[1].checked) {
				      cost = (Number($('#num_liter').val()) * Number($('#num_literCost').val())).toFixed(0);    
                   liter = $('#num_liter').val();
                }  else {
                  swal("주유량 또는 리터 선택후 기록하세요!");
                }
                
                if ($('#num_userMile').val() != '') {
                  mile = $('#num_userMile').val();
                } else {
                  mile = $('#num_driveMile').val();
                }
                
                //if ($('#date_refuelDate').val() < )
                
              $.post('addRefuel.do', {
                  myCarNo: sessionStorage.getItem('loginUsercarNo'),
                  refuelDate: $('#date_refuelDate').val(),
                  mile: mile,
                  cost: cost,
                  liter: liter,
                  literCost: $('#num_literCost').val()
                }, function(resultObj) {
                  var ajaxResult = resultObj.ajaxResult;
                  if (ajaxResult.status == "success") { 
                    swal({   
                      title: "주유 내역을 기록하였습니다!",   
                      text: "즐거운 이용 되세요.",   
                      type: "success",
                      confirmButtonText: "확인 : )" }, function() {
                        location.href = "refuel.html";
                      });
                   } else {
                     swal("주행기록은 조작할 수 없습니다 ; ( ", "등록되어 있는 주행거리 보다 높은 기록을 입력하세요.");
                   }
                }, 'json');
              });
            </script>
            
            <!-- 달력 폼 시작-->
            <div class="col-md-6 validation-grids validation-grids-right">
              <div class="widget-shadow" data-example-id="basic-forms">
                <div class="form-title">
                  <h4>: 주유했던 날을 보여드립니다.</h4>
                </div>
                <div class="form-body">

                  <div class="calendar">
                    <header>
                      <h2 class="month"></h2>
                      <a class="btn-prev fontawesome-angle-left"
                        href="#"></a> <a
                        class="btn-next fontawesome-angle-right"
                        href="#"></a>
                    </header>
                    <table>
                      <thead class="event-days">
                        <tr></tr>
                      </thead>
                      <tbody id="eventDay" class="event-calendar">
                        <tr class="1"></tr>
                        <tr class="2"></tr>
                        <tr class="3"></tr>
                        <tr class="4"></tr>
                        <tr class="5"></tr>
                      </tbody> 
                    </table>
                    
                    <!-- 주유날짜 달력 표시 부분 -->                    
                    <div id="monthList" class="list">
                      <!-- <div id="dateEvent" class="day-event" date-month="1" date-day="1" date-year="2016" data-number="2"></div> -->
                    </div>
                    
                      <!-- 월 주유금액 표시부분 -->
                    <div>
                      <h4 id="moneyTitle">이번달 총 주유 금액 입니다.</h4>
                      <label id="label_monMoney">00000원</label>
                      <h5 id="moneyTitle">DashBoard에서 회원 평균과 비교 하세요!</h5>
                    </div>
                    
                  </div>
                </div>
              </div>
            </div>
            <div class="clearfix"></div>
            <!-- // 달력 폼 끝 -->
            <!-- 기록 달력에 표시 하기 -->
            <script type="text/javascript">
              $.ajaxSetup({ async:false }); // ajax 동기 요청을 위한 셋팅 함수
              $.getJSON('monthList.do?no=' + sessionStorage.getItem('loginUsercarNo'), function(resultObj) {
                var dateArray = null;
                var year = null;
                var month = null;
                var day = null;
                var ajaxResult = resultObj.ajaxResult;
                var refuelDate = ajaxResult.data;
                if (ajaxResult.status == "success") {
                  for (var refuel of refuelDate) {
                    dateArray = refuel.group_date.split('-');
                    year = dateArray[0];
                    month = dateArray[1];
                    day = dateArray[2];
                    $("<div class='day-event' date-month='" + month + "'date-day='" + day + "'date-year='" + year + "'data-number='1'></div>").appendTo(monthList) 
                  }
                }
              });
            </script>
            <!-- 월별 주유 금액 -->
            <script type="text/javascript">
              $.ajaxSetup({ async:false });
              $.getJSON('monthCost.do?no=' + sessionStorage.getItem('loginUsercarNo'), function(resultObj) {
                var monthArray = null;
                var thisMonth = moment().format('YYYY-MM');
                var ajaxResult = resultObj.ajaxResult;
                var refuelDate = ajaxResult.data;
                if (ajaxResult.status == "success") {
			      for (var refuel of refuelDate) {
                    monthArray = refuel.cost.split('');
			      }
                }

              });
            </script>
            
            
            
            
          </div>
        </div>

      </div>
    </div>
    <!--footer-->
    <div class="footer">
      <p>
        &copy; 2016 Java76th 태웅 재한 영호 다인. All Rights Reserved | Project by <a href="" target="_blank">내 차를 부탁해</a>
      </p>
    </div>
    <!--//footer-->
  </div>

  <!-- Classie 메뉴 접히고 펼쳐지는 부분` -->
  <script src="../js/main/classie.js"></script>
  <script>
    var menuLeft = document.getElementById('cbp-spmenu-s1'), 
        showLeftPush = document.getElementById('showLeftPush'), 
        body = document.body;

    showLeftPush.onclick = function() {
      classie.toggle(this, 'active');
      classie.toggle(body, 'cbp-spmenu-push-toright');
      classie.toggle(menuLeft, 'cbp-spmenu-open');
      disableOther('showLeftPush');
    };

    function disableOther(button) {
      if (button !== 'showLeftPush') {
        classie.toggle(showLeftPush, 'disabled');
      }
    }
  </script>
  <!--scrolling js 스크롤바 조정-->
  <script src="../js/main/jquery.nicescroll.js"></script>
  <script src="../js/main/scripts.js"></script>
  <!--//scrolling js-->
  <!-- Bootstrap Core JavaScript -->
  <script src="../js/main/bootstrap.js"></script>
</body>
</html>
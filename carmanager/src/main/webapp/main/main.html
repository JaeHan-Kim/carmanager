<!DOCTYPE HTML>
<html>
<head>
<title>new 내 차를 부탁해</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords"
  content="Novus Admin Panel Responsive web template, Bootstrap Web Templates, Flat Web Templates, Android Compatible web template, 
SmartPhone Compatible web template, free WebDesigns for Nokia, Samsung, LG, SonyEricsson, Motorola web design" />
<script type="application/x-javascript">
  
  
   
addEventListener("load", function() { 
setTimeout(hideURLbar, 0); }, false); 
function hideURLbar(){ 
window.scrollTo(0,1); } 

</script>

<!-- Bootstrap Core CSS -->
<link href="../css/main/bootstrap.css" rel='stylesheet' type='text/css' />
<link href="../css/main/main.css" rel='stylesheet' type='text/css' />
<!-- Custom CSS 메뉴바()메뉴내용, 상단, 차트박스, 글자색 스타일 -->
<link href="../css/main/style.css" rel='stylesheet' type='text/css' />
<!-- font CSS -->
<!-- font-awesome icons 빈칸 유지를 위해 링크를 막아둠 -->
<!--<link href="../css/main/test/font-awesome.css" rel="stylesheet"> -->
<!-- //font-awesome icons -->
<!-- js-->
<script src="../js/main/jquery-1.11.1.min.js"></script>
<!-- sweetAlert -->
<script type="text/javascript" src="../lib/sweetalert/sweetalert.min.js"></script> 
<link rel="stylesheet" type="text/css" href="../lib/sweetalert/sweetalert.css">

<script src="../js/main/modernizr.custom.js"></script>
<!--webfonts 없어도 되는듯..? -->
<link
  href='//fonts.googleapis.com/css?family=Roboto+Condensed:400,300,300italic,400italic,700,700italic'
  rel='stylesheet' type='text/css'>
<!--//webfonts-->
<!--animate-->
<link href="../css/main/animate.css" rel="stylesheet" type="text/css"
  media="all">
<script src="../js/main/wow.min.js"></script>
<script>
  new WOW().init();
  $(document).ready(function(){
    $('#blank').css('display', 'none')
    $('#exCar').css('display', 'none')
    var userNickname = sessionStorage.getItem('loginUserNickname')+ "님";
    var userCarNo = sessionStorage.getItem('selectCarNo');
    var userPhoto = sessionStorage.getItem('loginUserPhoto');
    $("#userNickname").html(userNickname);
    $("#thumbnail").attr("src", "../img/member/m-" + userPhoto + ".png");
    if (userCarNo == 0) {
      $('#blank').css('display', '')
      $('#exCar').css('display', 'none')
    } else {
      $('#exCar').css('display', '')
      $('#blank').css('display', 'none')
    }
 });  
</script>
<!--//end-animate-->

<!-- chart 챠트 -->
<script src="../lib/Chart.js/Chart.js"></script>
<!-- 차트에 날짜 데이터 이용하기 -->
<script src="../js/main/moment_local.js" type="text/javascript"></script>
<!-- //chart -->

<!--Calender-->
<!--<link rel="stylesheet" href="css/clndr.css" type="text/css" />
<script src="js/underscore-min.js" type="text/javascript"></script>
<script src= "js/moment-2.2.1.js" type="text/javascript"></script>
<script src="js/clndr.js" type="text/javascript"></script>
<script src="js/site.js" type="text/javascript"></script>-->
<!--End Calender-->
<!-- Metis Menu -->
<script src="../js/main/metisMenu.min.js"></script>
<script src="../js/main/custom.js"></script>
<link href="../css/main/custom.css" rel="stylesheet">
<!--//Metis Menu -->
<!-- 차량 선택 라이브러리 -->
<link rel="stylesheet" href="../css/main/default.css">
<script src="../js/main/jquery.selecty.js"></script>
<!-- // 차량 선택 라이브러리 -->
</head>
<body class="cbp-spmenu-push">
  <div class="main-content">
    <!--left-fixed -navigation-->
    <div class=" sidebar" role="navigation">
      <div class="navbar-collapse">
        <nav class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left"
          id="cbp-spmenu-s1">
          <ul class="nav" id="side-menu">
            <li><a href="../main/main.html" class=""><i
                class="fa fa-home nav_icon"></i>Dashboard</a></li>
            <li><a href="../mypage/mypage.html" class=""><i
                class="fa fa-home nav_icon"></i>My page</a></li>
            <li><a href="../garage/garage.html" class=""><i
                class="fa fa-home nav_icon"></i>차량 등록</a></li>
            <li><a href="../refuel/refuel.html" class=""><i
                class="fa fa-home nav_icon"></i>차량 관리</a></li>
            <li><a href="../center/center.html" class=""><i
                class="fa fa-home nav_icon"></i>정 비 소</a></li>
            <li><a href="../goods/goods.html" class=""><i
                class="fa fa-home nav_icon"></i>맞춤 서비스</a></li>
            <li><a href="../community/community.html" class=""><i
                class="fa fa-home nav_icon"></i>커뮤니티</a></li>
          </ul>
          <!-- //sidebar-collapse -->
        </nav>
      </div>
    </div>
    <!--left-fixed -navigation-->

    <!-- header-starts -->
    <div class="sticky-header header-section ">
      <div class="header-left">
        <!--toggle button start-->
        <button id="showLeftPush">
          <img src="../img/main/menu.png">
        </button>
        <!--toggle button end-->
        <!--logo -->
        <div class="logo">
          <a href="../main/main.html">
            <h1>내 차를 부탁해</h1> <span>간편, 쉽고, 재밌는 시작!</span>
          </a>
        </div>
        <!--//logo-->
        <!--search-box-->
        <!--<div class="search-box">
          <form class="input">
            <input class="sb-search-input input__field--madoka" placeholder="Search..." type="search" id="input-31" />
            <label class="input__label" for="input-31">
              <svg class="graphic" width="100%" height="100%" viewBox="0 0 404 77" preserveAspectRatio="none">
                <path d="m0,0l404,0l0,77l-404,0l0,-77z"/>
              </svg>
            </label>
          </form>
        </div>
        <!-- end-search-box-->
        <div class="clearfix"> </div>
      </div>
      <!-- header-left end-->

      <!-- header-right -->
      <div class="header-right">
        <!-- 유저별 차량 리스트 -->
          <div class="profile_details_left">
            <label id="selectCarTitle">&nbsp;&nbsp;* 현재 선택된 차량입니다 :&nbsp;</label>
            <div class="clearfix"></div>
              <select id="myCarList" class="selecty s2 selectCar" name="town" id="town">
              </select>
         </div>
        <!-- 유저별 차량 리스트 end -->

        <!-- 로그인 유저 정보 -->
        <div class="profile_details">
          <ul>
            <li class="dropdown profile_details_drop">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                <div class="profile_img">
                  <span class="prfil-img">
                  <img id ="thumbnail" src="" alt=""> </span>
                  <div class="user-name">
                    <p id="userNickname"></p>
                    <span>안녕하세요.</span>
                  </div>
                  <!-- 빈칸 유지를 위한 아이콘 자리 -->
                  <i class="fa fa-angle-down lnr"></i>
                  <i class="fa fa-angle-up lnr"></i>
                  <div class="clearfix"></div>
                </div>
            </a>
              <ul class="dropdown-menu drp-mnu">
                <li><a id="Mypage" href="#"><i class="fa fa-cog"></i>My page</a></li>
                <li><a id="Logout" href="#"><i class="fa fa-sign-out"></i>Logout</a></li>
              </ul>
            </li>
          </ul>
       </div>
        <!-- 로그인 유저 정보 end -->
        <div class="clearfix"></div>
      </div>
      <!-- header-right -->
      <div class="clearfix"></div>
    </div>
    <!-- //header-ends -->
    <!--   로그 아웃 클릭 이벤트 -->
    <script>
    $('#Mypage').click(function(event){
        location.href = "../mypage/mypage.html";
    });
    
    $('#Logout').click(function(event){
        event.preventDefault();
        sessionStorage.removeItem('loginUserNickname');
       /*  sessionStorage.removeItem('loginUsercarNo'); */
        sessionStorage.removeItem('loginUserPhoto');
        sessionStorage.removeItem('selectCarNo');
        location.href = "../auth/login.html";
      });
    </script>
    <!-- main content start-->
    <div id="page-wrapper">
      <div class="main-page">
         
         <!-- 차량 정보가 없을 때 시작 페이지 -->
         <div id="blank" class="media">
          <h2 class="title1">반갑습니다 : ) 처음이신가요?</h2>
          <div class="bs-example5 widget-shadow"
            data-example-id="default-media">

            <div class="media">
              <div class="media-left">
                <a href="#"> <img class="media-object"
                  data-src="holder.js/64x64" alt="64x64"
                  src="../img/main/simple.png"
                  data-holder-rendered="true"
                  style="width: 250px; height: 150px;">
                </a>
              </div>
              <div class="media-body">
                <h3 class="media-heading">간편 합니다. 먼저 차량을 등록하세요!</h3>
                <h4>누적거리를 잊으셨나요? 리터당 얼마에 넣었는지 깜빡하셨다구요? 걱정마세요. 처음 주유
                  기록을 바탕으로 추정 누적거리를 입력해 드리고, 전국 평균 단가를 넣어 번거로움을 최소화 시켜
                  드립니다.</h4>
              </div>
              <div class="clearfix"></div>
            </div>

            <div class="media">
              <div class="media-body">
                <h3 class="media-heading">매우 쉬워요. 차량 등록을 하셨나요? 그러면
                  주유 기록을 등록해 보세요.</h3>
                <h4>꾸준한 차량 관리를 위해서 용어를 찾아 해맨 당신, '내 차를 부탁해'에서는 왼쪽
                  메뉴에서 바로 들어가 등록하고 직관적으로 보여드립니다.</h4>
              </div>
              <div class="media-right">
                <a href="#"> <img class="media-object"
                  data-src="holder.js/64x64" alt="64x64"
                  src="../img/main/easy.png" data-holder-rendered="true"
                  style="width: 150px; height: 150px;">
                </a>
              </div>
            </div>

            <div class="media">
              <div class="media-left">
                <a href="#"> <img class="media-object"
                  data-src="holder.js/64x64" alt="64x64"
                  src="../img/main/fun.png" data-holder-rendered="true"
                  style="width: 250px; height: 150px;">
                </a>
              </div>
              <div class="media-body">
                <h3 class="media-heading">재미있어요!</h3>
                <h4>주유기록, 소모품 기록을 보기 위해 돌아다니지 마세요. DashBoard에서 눈에 쏙
                  들어오는 차트를 확인하고 교체시기가 다가오는 부품은 차량 이미지로 재밌게 알 수 있습니다.</h4>
              </div>
              <!--<div class="clearfix"> </div>-->
            </div>

            <div class="media">
              <div class="media-body">
                <h3 class="media-heading">아주 유용합니다.</h3>
                <h4>근처에 있는 차량 서비스센터 안내, 소모품 최저가 안내 및 공유 등 필요한 정보만
                  담았습니다. 지금 이용해 보세요!</h4>
              </div>
              <div class="media-right">
                <a href="#"> <img class="media-object"
                  data-src="holder.js/64x64" alt="64x64"
                  src="../img/main/usefull.png"
                  data-holder-rendered="true"
                  style="width: 250px; height: 150px;">
                </a>
              </div>
            </div>

          </div>

          <!--<div class="clearfix"> </div>-->
        </div>
        <!-- 차량 정보 없을 때 시작페이지 끝 -->

        <!-- 차트 위 택스트 차량 정보 있을 때 -->
       <div id="exCar">
        
        <!-- 차트 시작 -->
        <div class="charts">
          <div class="col-md-4 charts-grids widget">
            <h4 id="topL" class="title">월별 주유 금액 입니다.</h4>
            <canvas id="bar" height="300" width="400"> </canvas>
            <div id="bar-legend" class="chart-legend"></div>
          </div>
          <div class="col-md-4 charts-grids widget states-mdl">
            <h4 class="title">저번 주유 대비 연비 개선율 입니다.</h4>
            <canvas id="doughnut" height="300" width="400"> </canvas>
          </div>
          <div class="col-md-4 charts-grids widget">
            <h4 id="topR" class="title">공인 연비 대비 연비 입니다.</h4>
            <canvas id="line" height="300" width="400"> </canvas>
       		 <div id="line-legend" class="chart-legend"></div>
          </div>
          <div class="clearfix"></div>

          <script>
          var selectcar = $("#myCarList");
          var cnt = 0;
          
          $('#myCarList').change(function(){
            /* alert($("#myCarList").val()); */
            sessionStorage.setItem('selectCarNo', $("#myCarList").val());
            /* alert(sessionStorage.getItem("selectCarNo")); */
            $("#line").remove();
            $("#bar").remove();
            $.getJSON('list.do?no=' + sessionStorage.getItem("loginUser") + '&carNo='+$("#myCarList").val(), 
                function(resultObj) {
                  $("<canvas id='bar' height='400' width='450'></canvas>").appendTo("#topL");
                  $("<canvas id='line' height='400' width='450'></canvas>").appendTo("#topR");
                  lineChart(resultObj);
                  barChart(resultObj);
                });
          });
          $.getJSON('list.do?no=' + sessionStorage.getItem("loginUser") + '&carNo='+sessionStorage.getItem("selectCarNo"), function(resultObj) {
            /* alert(sessionStorage.getItem('loginUsercarNo')); */
            for (var garage of resultObj.data) {
              $("<option value='"+ garage.myCarNo +"'>"+ garage.nickName +"</option>").appendTo('#myCarList');
           	} 
            /* alert(sessionStorage.getItem("selectCarNo")); */
           $('#myCarList option[value='+ sessionStorage.getItem("selectCarNo") +']').attr('selected', 'selected');
            $('.selecty').selecty();
           lineChart(resultObj);
           barChart(resultObj);
         });
        function lineChart(resultObj) {
          var effic = new Array();
          var driveDt = new Array();
          
          if (resultObj.refuelList != "") {
            for (var i = 0; i < 7; i++) {
              effic[i] = ((resultObj.refuelList[i].mile-resultObj.refuelList[i+1].mile)/resultObj.refuelList[i+1].liter).toFixed(2);
              driveDt[i] = resultObj.refuelList[i].group_date
              //driveDt[i] = resultObj.refuelList[i+1].group_date + "~" + resultObj.refuelList[i].group_date
             }
          }
            var lineChartData = {
              labels : [driveDt[6],driveDt[5],driveDt[4],driveDt[3],driveDt[2],driveDt[1],driveDt[0]],
              datasets : [
                {
                  label: "구간연비",
                  fillColor : "rgba(220,220,220,0.2)",
                  strokeColor : "rgba(220,220,220,1)",
                  pointColor : "rgba(220,220,220,1)",
                  pointStrokeColor : "#fff",
                  pointHighlightFill : "#fff",
                  pointHighlightStroke : "rgba(220,220,220,1)",
                  data :  [effic[6],
                           effic[5],
                           effic[4],
                           effic[3],
                           effic[2],
                           effic[1],
                           effic[0]]
                },
                {
                  label: "공인연비",
                  fillColor : "rgba(151,187,205,0.2)",
                  strokeColor : "rgba(151,187,205,1)",
                  pointColor : "rgba(151,187,205,1)",
                  pointStrokeColor : "#fff",
                  pointHighlightFill : "#fff",
                  pointHighlightStroke : "rgba(151,187,205,1)",
                  data : [resultObj.refuelList[0].effi,
                          resultObj.refuelList[0].effi,
                          resultObj.refuelList[0].effi,
                          resultObj.refuelList[0].effi,
                          resultObj.refuelList[0].effi,
                          resultObj.refuelList[0].effi,
                          resultObj.refuelList[0].effi]
                }
              ]
          
            }
          var ctx1 = document.getElementById("line").getContext("2d");
          myLine = new Chart(ctx1).Line(lineChartData, {
            responsive: true,
            legendTemplate : "<ul class=\"<%=name.toLowerCase()%>-legend\">"+
            "<% for (var i=0; i<datasets.length; i++){%>"+
              "<li><span style=\"background-color:<%=datasets[i].strokeColor%>\"></span>"+
              "<%if(datasets[i].label){%><%=datasets[i].label%><%}%>"+
              "</li><%}%>"+
              "(단위: Km)</ul>"
          });
          document.getElementById('line-legend').innerHTML = myLine.generateLegend();
          }
        
        function barChart(resultObj) {
           var twoago = (moment().subtract(60, 'days').months() + 1) + "월";
            var oneago = (moment().subtract(30, 'days').months() + 1) + "월";
            var present = moment().format('MM')  + "월";
               var barChartData = {
                 labels : [twoago, oneago, present],
                 datasets : [
                   {
                     label: "회원평균",
                     fillColor : "rgba(233, 78, 2, 0.9)",
                     strokeColor : "rgba(233, 78, 2, 0.9)",
                     highlightFill: "#e94e02",
                     highlightStroke: "#e94e02",
                     data : [(resultObj.memCostAvg[2].cost/=1000).toFixed(2), 
                            (resultObj.memCostAvg[1].cost/=1000).toFixed(2), 
                            (resultObj.memCostAvg[0].cost/=1000).toFixed(2)]
                   },
                   {
                     label: "개인평균",
                     fillColor : "rgba(79, 82, 186, 0.9)",
                     strokeColor : "rgba(79, 82, 186, 0.9)",
                     highlightFill: "#4F52BA",
                     highlightStroke: "#4F52BA",
                     data : [(resultObj.myCostAvg[2].cost/=1000).toFixed(2), 
                            (resultObj.myCostAvg[1].cost/=1000).toFixed(2),
                            (resultObj.myCostAvg[0].cost/=1000).toFixed(2)]
                   }
                 ]
               };
            var ctx = document.getElementById("bar").getContext("2d");
            var myBar = new Chart(ctx).Bar(barChartData, {
            responsive : true,
            datasetStroke : true,
            legendTemplate : 
              "<ul class=\"<%=name.toLowerCase()%>-legend\">"+
            	"<% for (var i=0; i<datasets.length; i++){%>"+
            	"<li><span style=\"background-color:<%=datasets[i].fillColor%>\"></span>"+
            	"<%if(datasets[i].label){%><%=datasets[i].label%><%}%>"+
            	"</li><%}%>"+
            	"(단위: 천원)</ul>"
      
            });
            document.getElementById('bar-legend').innerHTML = myBar.generateLegend();
          }
        var doughnutData = [
  			{
  				value: 300,
  				color:"#F7464A",
  				highlight: "#FF5A5E",
  				label: "Red"
  			},
  			{
  				value: 50,
  				color: "#46BFBD",
  				highlight: "#5AD3D1",
  				label: "Green"
  			},
  			{
  				value: 100,
  				color: "#FDB45C",
  				highlight: "#FFC870",
  				label: "Yellow"
  			},
  			{
  				value: 40,
  				color: "#949FB1",
  				highlight: "#A8B3C5",
  				label: "Grey"
  			},
  			{
  				value: 120,
  				color: "#4D5360",
  				highlight: "#616774",
  				label: "Dark Grey"
  			}
  
  		];
  
  			var ctx3 = document.getElementById("doughnut").getContext("2d");
  			var myDoughnut = new Chart(ctx3).Doughnut(doughnutData, {responsive : true});

        </script>

        </div>
        <!-- 차트 끝 -->
        
        <!-- 소모품 안내 시작 -->
        <div class="row calender widget-shadow">
          <h4 class="title">교체 시기가 다가오는 소모품을 확인하세요.</h4>
          <div class="cal1">
            <img src="../img/main/car_condition.png">
          </div>
        </div>
        <div class="clearfix"></div>
        <!-- /소모품 안내 끝 -->
      
      </div>

      </div>
    </div>
    <!--footer-->
    <div class="footer">
      <p>
        &copy; 2016 Java76th 태웅 재한 영호 다인. All Rights Reserved | Project
        by <a href="" target="_blank">내 차를 부탁해</a>
      </p>
    </div>
    <!--//footer-->
  </div>

  <!-- Classie 메뉴 접히고 펼쳐지는 부분` -->
  <script src="../js/main/classie.js"></script>
  <script>
      var menuLeft = document.getElementById('cbp-spmenu-s1'), showLeftPush = document
          .getElementById('showLeftPush'), body = document.body;

      showLeftPush.onclick = function() {
        classie.toggle(this, 'active');
        classie.toggle(body, 'cbp-spmenu-push-toright');
        classie.toggle(menuLeft, 'cbp-spmenu-open');
        disableOther('showLeftPush');
      };

      function disableOther(button) {
        if (button !== 'showLeftPush') {
          classie.toggle(showLeftPush, 'disabled');
        }
      }
    </script>
  <!--scrolling js 스크롤바 조정-->
  <script src="../js/main/jquery.nicescroll.js"></script>
  <script src="../js/main/scripts.js"></script>
  <!--//scrolling js-->
  <!-- Bootstrap Core JavaScript -->
  <script src="../js/main/bootstrap.js">
      
    </script>
</body>
</html>